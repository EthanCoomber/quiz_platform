(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{4444:function(t,e,n){"use strict";n.d(e,{BH:function(){return T},L:function(){return o},LL:function(){return _},P0:function(){return v},Pz:function(){return I},Sg:function(){return b},ZR:function(){return E},aH:function(){return w},b$:function(){return l},eu:function(){return p},hl:function(){return f},m9:function(){return M},ne:function(){return O},pd:function(){return R},q4:function(){return y},ru:function(){return h},tV:function(){return a},uI:function(){return u},vZ:function(){return C},w1:function(){return d},xO:function(){return N},xb:function(){return k},z$:function(){return c},zd:function(){return D}});var r=n(3454);const s=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296===(64512&s)&&r+1<t.length&&56320===(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const e=t[s],i=s+1<t.length,o=i?t[s+1]:0,a=s+2<t.length,c=a?t[s+2]:0,u=e>>2,h=(3&e)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const e=n[t.charAt(s++)],i=s<t.length?n[t.charAt(s)]:0;++s;const o=s<t.length?n[t.charAt(s)]:64;++s;const a=s<t.length?n[t.charAt(s)]:64;if(++s,null==e||null==i||null==o||null==a)throw Error();const c=e<<2|i>>4;if(r.push(c),64!==o){const t=i<<4&240|o>>2;if(r.push(t),64!==a){const t=o<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},o=function(t){return function(t){const e=s(t);return i.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=function(t){try{return i.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function u(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function h(){const t="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof t&&void 0!==t.id}function l(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function d(){const t=c();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function f(){return"object"===typeof indexedDB}function p(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(n){e(n)}}))}const m=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,g=()=>{try{return m()||(()=>{if("undefined"===typeof r||"undefined"===typeof r.env)return;const t=r.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const e=t&&a(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},y=t=>{var e,n;return null===(n=null===(e=g())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},v=t=>{const e=y(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},w=()=>{var t;return null===(t=g())||void 0===t?void 0:t.config},I=t=>{var e;return null===(e=g())||void 0===e?void 0:e[`_${t}`]};class T{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"===typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function b(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(i)),""].join(".")}class E extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(S,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new E(r,o,n)}}const S=/\{\$([^}]+)}/g;function k(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function C(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(A(n)&&A(i)){if(!C(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function A(t){return null!==t&&"object"===typeof t}function N(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function D(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,r]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(r)}})),e}function R(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function O(t,e){const n=new L(t,e);return n.subscribe.bind(n)}class L{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let r;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");r=function(t,e){if("object"!==typeof t||null===t)return!1;for(const n of e)if(n in t&&"function"===typeof t[n])return!0;return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n},void 0===r.next&&(r.next=P),void 0===r.error&&(r.error=P),void 0===r.complete&&(r.complete=P);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(t){}})),this.observers.push(r),s}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function P(){}function M(t){return t&&t._delegate?t._delegate:t}},8006:function(t,e,n){"use strict";n.d(e,{S$:function(){return dt},Xb:function(){return Ft},v0:function(){return rn},Aj:function(){return Bt},e5:function(){return jt},ck:function(){return qt}});var r=n(4444),s=n(5816),i=n(3333),o=n(655),a=n(8463);function c(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const u=c,h=new r.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),l=new i.Yd("@firebase/auth");function d(t,...e){l.logLevel<=i.in.ERROR&&l.error(`Auth (${s.Jn}): ${t}`,...e)}function f(t,...e){throw g(t,...e)}function p(t,...e){return g(t,...e)}function m(t,e,n){const s=Object.assign(Object.assign({},u()),{[e]:n});return new r.LL("auth","Firebase",s).create(e,{appName:t.name})}function g(t,...e){if("string"!==typeof t){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return h.create(t,...e)}function y(t,e,...n){if(!t)throw g(e,...n)}function v(t){const e="INTERNAL ASSERTION FAILED: "+t;throw d(e),new Error(e)}function w(t,e){t||v(e)}const I=new Map;function T(t){w(t instanceof Function,"Expected a class definition");let e=I.get(t);return e?(w(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,I.set(t,e),e)}function b(){var t;return"undefined"!==typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function E(){return"http:"===_()||"https:"===_()}function _(){var t;return"undefined"!==typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class S{constructor(t,e){this.shortDelay=t,this.longDelay=e,w(e>t,"Short delay should be less than long delay!"),this.isMobile=(0,r.uI)()||(0,r.b$)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(E()||(0,r.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function k(t,e){w(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class C{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void v("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void v("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void v("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const A={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},N=new S(3e4,6e4);function D(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function R(t,e,n,s,i={}){return O(t,i,(async()=>{let i={},o={};s&&("GET"===e?o=s:i={body:JSON.stringify(s)});const a=(0,r.xO)(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode),C.fetch()(P(t,t.config.apiHost,n,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},i))}))}async function O(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},A),e);try{const e=new M(t),r=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw x(t,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const e=r.ok?i.errorMessage:i.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw x(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw x(t,"email-already-in-use",i);if("USER_DISABLED"===n)throw x(t,"user-disabled",i);const a=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw m(t,a,o);f(t,a)}}catch(i){if(i instanceof r.ZR)throw i;f(t,"network-request-failed")}}async function L(t,e,n,r,s={}){const i=await R(t,e,n,r,s);return"mfaPendingCredential"in i&&f(t,"multi-factor-auth-required",{_serverResponse:i}),i}function P(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?k(t.config,s):`${t.config.apiScheme}://${s}`}class M{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(p(this.auth,"network-request-failed"))),N.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function x(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=p(t,e,r);return s.customData._tokenResponse=n,s}function U(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(e){}}function V(t){return 1e3*Number(t)}function F(t){var e;const[n,s,i]=t.split(".");if(void 0===n||void 0===s||void 0===i)return d("JWT malformed, contained fewer than 3 sections"),null;try{const t=(0,r.tV)(s);return t?JSON.parse(t):(d("Failed to decode base64 JWT payload"),null)}catch(o){return d("Caught error parsing JWT payload as JSON",null===(e=o)||void 0===e?void 0:e.toString()),null}}async function j(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof r.ZR&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}class q{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){var t;try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===(t=e)||void 0===t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class B{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=U(this.lastLoginAt),this.creationTime=U(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function z(t){var e;const n=t.auth,r=await t.getIdToken(),s=await j(t,async function(t,e){return R(t,"POST","/v1/accounts:lookup",e)}(n,{idToken:r}));y(null===s||void 0===s?void 0:s.users.length,n,"internal-error");const i=s.users[0];t._notifyReloadListener(i);const a=(null===(e=i.providerUserInfo)||void 0===e?void 0:e.length)?i.providerUserInfo.map((t=>{var{providerId:e}=t,n=(0,o.__rest)(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const c=(u=t.providerData,h=a,[...u.filter((t=>!h.some((e=>e.providerId===t.providerId)))),...h]);var u,h;const l=t.isAnonymous,d=!(t.email&&i.passwordHash)&&!(null===c||void 0===c?void 0:c.length),f=!!l&&d,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new B(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(t,p)}class ${constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){y(t.idToken,"internal-error"),y("undefined"!==typeof t.idToken,"internal-error"),y("undefined"!==typeof t.refreshToken,"internal-error");const e="expiresIn"in t&&"undefined"!==typeof t.expiresIn?Number(t.expiresIn):function(t){const e=F(t);return y(e,"internal-error"),y("undefined"!==typeof e.exp,"internal-error"),y("undefined"!==typeof e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return y(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:s,expiresIn:i}=await async function(t,e){const n=await O(t,{},(async()=>{const n=(0,r.xO)({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=P(t,s,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",C.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,s,Number(i))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:r,expirationTime:s}=e,i=new $;return n&&(y("string"===typeof n,"internal-error",{appName:t}),i.refreshToken=n),r&&(y("string"===typeof r,"internal-error",{appName:t}),i.accessToken=r),s&&(y("number"===typeof s,"internal-error",{appName:t}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new $,this.toJSON())}_performRefresh(){return v("not implemented")}}function K(t,e){y("string"===typeof t||"undefined"===typeof t,"internal-error",{appName:e})}class H{constructor(t){var{uid:e,auth:n,stsTokenManager:r}=t,s=(0,o.__rest)(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new q(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new B(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await j(this,this.stsTokenManager.getToken(this.auth,t));return y(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=(0,r.m9)(t),s=await n.getIdToken(e),i=F(s);y(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o="object"===typeof i.firebase?i.firebase:void 0,a=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:i,token:s,authTime:U(V(i.auth_time)),issuedAtTime:U(V(i.iat)),expirationTime:U(V(i.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=(0,r.m9)(t);await z(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(y(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){return new H(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(t){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await z(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await j(this,async function(t,e){return R(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,r,s,i,o,a,c,u;const h=null!==(n=e.displayName)&&void 0!==n?n:void 0,l=null!==(r=e.email)&&void 0!==r?r:void 0,d=null!==(s=e.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=e.photoURL)&&void 0!==i?i:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,m=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=e.createdAt)&&void 0!==c?c:void 0,v=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:I,isAnonymous:T,providerData:b,stsTokenManager:E}=e;y(w&&E,t,"internal-error");const _=$.fromJSON(this.name,E);y("string"===typeof w,t,"internal-error"),K(h,t.name),K(l,t.name),y("boolean"===typeof I,t,"internal-error"),y("boolean"===typeof T,t,"internal-error"),K(d,t.name),K(f,t.name),K(p,t.name),K(m,t.name),K(g,t.name),K(v,t.name);const S=new H({uid:w,auth:t,email:l,emailVerified:I,displayName:h,isAnonymous:T,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:g,lastLoginAt:v});return b&&Array.isArray(b)&&(S.providerData=b.map((t=>Object.assign({},t)))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(t,e,n=!1){const r=new $;r.updateFromServerResponse(e);const s=new H({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:n});return await z(s),s}}class G{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}G.type="NONE";const W=G;function Q(t,e,n){return`firebase:${t}:${e}:${n}`}class X{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=Q(this.userKey,r.apiKey,s),this.fullPersistenceKey=Q("persistence",r.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?H._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new X(T(W),t,n);const r=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let s=r[0]||T(W);const i=Q(n,t.config.apiKey,t.name);let o=null;for(const u of e)try{const e=await u._get(i);if(e){const n=H._fromJSON(t,e);u!==s&&(o=n),s=u;break}}catch(c){}const a=r.filter((t=>t._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==s)try{await t._remove(i)}catch(c){}}))),new X(s,t,n)):new X(s,t,n)}}function J(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(et(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Y(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(rt(e))return"Blackberry";if(st(e))return"Webos";if(Z(e))return"Safari";if((e.includes("chrome/")||tt(e))&&!e.includes("edge/"))return"Chrome";if(nt(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Y(t=(0,r.z$)()){return/firefox\//i.test(t)}function Z(t=(0,r.z$)()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tt(t=(0,r.z$)()){return/crios\//i.test(t)}function et(t=(0,r.z$)()){return/iemobile/i.test(t)}function nt(t=(0,r.z$)()){return/android/i.test(t)}function rt(t=(0,r.z$)()){return/blackberry/i.test(t)}function st(t=(0,r.z$)()){return/webos/i.test(t)}function it(t=(0,r.z$)()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function ot(t=(0,r.z$)()){return it(t)||nt(t)||st(t)||rt(t)||/windows phone/i.test(t)||et(t)}function at(t,e=[]){let n;switch(t){case"Browser":n=J((0,r.z$)());break;case"Worker":n=`${J((0,r.z$)())}-${t}`;break;default:n=t}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.Jn}/${i}`}class ct{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,r)=>{try{n(t(e))}catch(s){r(s)}}));n.onAbort=e,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(t){var e;if(this.auth.currentUser===t)return;const n=[];try{for(const e of this.queue)await e(t),e.onAbort&&n.push(e.onAbort)}catch(r){n.reverse();for(const t of n)try{t()}catch(s){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(e=r)||void 0===e?void 0:e.message})}}}class ut{constructor(t,e,n){this.app=t,this.heartbeatServiceProvider=e,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lt(this),this.idTokenSubscription=new lt(this),this.beforeStateQueue=new ct(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=T(e)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await X.create(this,t),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(t,!0)):void 0}async initializeCurrentUser(t){var e;const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,i=null===r||void 0===r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==i||!(null===o||void 0===o?void 0:o.user)||(r=o.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(i)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(n){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){var e;try{await z(t)}catch(n){if("auth/network-request-failed"!==(null===(e=n)||void 0===e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?(0,r.m9)(t):null;return e&&y(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&y(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(T(t))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new r.LL("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&T(t)||this._popupRedirectResolver;y(e,this,"argument-error"),this.redirectPersistenceManager=await X.create(this,[T(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,r){if(this._deleted)return()=>{};const s="function"===typeof e?e:e.next.bind(e),i=this._isInitialized?Promise.resolve():this._initializationPromise;return y(i,this,"internal-error"),i.then((()=>s(this.currentUser))),"function"===typeof e?t.addObserver(e,n,r):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=at(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return n&&(e["X-Firebase-Client"]=n),e}}function ht(t){return(0,r.m9)(t)}class lt{constructor(t){this.auth=t,this.observer=null,this.addObserver=(0,r.ne)((t=>this.observer=t))}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function dt(t,e,n){const r=ht(t);y(r._canInitEmulator,r,"emulator-config-failed"),y(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(null===n||void 0===n?void 0:n.disableWarnings),i=ft(e),{host:o,port:a}=function(t){const e=ft(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const t=s[1];return{host:t,port:pt(r.substr(t.length+1))}}{const[t,e]=r.split(":");return{host:t,port:pt(e)}}}(e),c=null===a?"":`:${a}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}function ft(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function pt(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class mt{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return v("not implemented")}_getIdTokenResponse(t){return v("not implemented")}_linkToIdToken(t,e){return v("not implemented")}_getReauthenticationResolver(t){return v("not implemented")}}async function gt(t,e){return R(t,"POST","/v1/accounts:update",e)}class yt extends mt{constructor(t,e,n,r=null){super("password",n),this._email=t,this._password=e,this._tenantId=r}static _fromEmailAndPassword(t,e){return new yt(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new yt(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"===typeof t?JSON.parse(t):t;if((null===e||void 0===e?void 0:e.email)&&(null===e||void 0===e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(t,e){return L(t,"POST","/v1/accounts:signInWithPassword",D(t,e))}(t,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return L(t,"POST","/v1/accounts:signInWithEmailLink",D(t,e))}(t,{email:this._email,oobCode:this._password});default:f(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return gt(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return L(t,"POST","/v1/accounts:signInWithEmailLink",D(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:f(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function vt(t,e){return L(t,"POST","/v1/accounts:signInWithIdp",D(t,e))}class wt extends mt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new wt(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):f("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"===typeof t?JSON.parse(t):t,{providerId:n,signInMethod:r}=e,s=(0,o.__rest)(e,["providerId","signInMethod"]);if(!n||!r)return null;const i=new wt(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(t){return vt(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,vt(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,vt(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=(0,r.xO)(e)}return t}}const It={USER_NOT_FOUND:"user-not-found"};class Tt extends mt{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new Tt({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new Tt({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return L(t,"POST","/v1/accounts:signInWithPhoneNumber",D(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await L(t,"POST","/v1/accounts:signInWithPhoneNumber",D(t,e));if(n.temporaryProof)throw x(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return L(t,"POST","/v1/accounts:signInWithPhoneNumber",D(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),It)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:r}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:r}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"===typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:r,temporaryProof:s}=t;return n||e||r||s?new Tt({verificationId:e,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class bt{constructor(t){var e,n,s,i,o,a;const c=(0,r.zd)((0,r.pd)(t)),u=null!==(e=c.apiKey)&&void 0!==e?e:null,h=null!==(n=c.oobCode)&&void 0!==n?n:null,l=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(s=c.mode)&&void 0!==s?s:null);y(u&&h&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=h,this.continueUrl=null!==(i=c.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(t){const e=function(t){const e=(0,r.zd)((0,r.pd)(t)).link,n=e?(0,r.zd)((0,r.pd)(e)).deep_link_id:null,s=(0,r.zd)((0,r.pd)(t)).deep_link_id;return(s?(0,r.zd)((0,r.pd)(s)).link:null)||s||n||e||t}(t);try{return new bt(e)}catch(n){return null}}}class Et{constructor(){this.providerId=Et.PROVIDER_ID}static credential(t,e){return yt._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=bt.parseLink(e);return y(n,"argument-error"),yt._fromEmailAndCode(t,n.code,n.tenantId)}}Et.PROVIDER_ID="password",Et.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Et.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class _t{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class St extends _t{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class kt extends St{constructor(){super("facebook.com")}static credential(t){return wt._fromParams({providerId:kt.PROVIDER_ID,signInMethod:kt.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return kt.credentialFromTaggedObject(t)}static credentialFromError(t){return kt.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return kt.credential(t.oauthAccessToken)}catch(e){return null}}}kt.FACEBOOK_SIGN_IN_METHOD="facebook.com",kt.PROVIDER_ID="facebook.com";class Ct extends St{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return wt._fromParams({providerId:Ct.PROVIDER_ID,signInMethod:Ct.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Ct.credentialFromTaggedObject(t)}static credentialFromError(t){return Ct.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return Ct.credential(e,n)}catch(r){return null}}}Ct.GOOGLE_SIGN_IN_METHOD="google.com",Ct.PROVIDER_ID="google.com";class At extends St{constructor(){super("github.com")}static credential(t){return wt._fromParams({providerId:At.PROVIDER_ID,signInMethod:At.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return At.credentialFromTaggedObject(t)}static credentialFromError(t){return At.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return At.credential(t.oauthAccessToken)}catch(e){return null}}}At.GITHUB_SIGN_IN_METHOD="github.com",At.PROVIDER_ID="github.com";class Nt extends St{constructor(){super("twitter.com")}static credential(t,e){return wt._fromParams({providerId:Nt.PROVIDER_ID,signInMethod:Nt.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Nt.credentialFromTaggedObject(t)}static credentialFromError(t){return Nt.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Nt.credential(e,n)}catch(r){return null}}}async function Dt(t,e){return L(t,"POST","/v1/accounts:signUp",D(t,e))}Nt.TWITTER_SIGN_IN_METHOD="twitter.com",Nt.PROVIDER_ID="twitter.com";class Rt{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,r=!1){const s=await H._fromIdTokenResponse(t,n,r),i=Ot(n);return new Rt({user:s,providerId:i,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const r=Ot(n);return new Rt({user:t,providerId:r,_tokenResponse:n,operationType:e})}}function Ot(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Lt extends r.ZR{constructor(t,e,n,r){var s;super(e.code,e.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Lt.prototype),this.customData={appName:t.name,tenantId:null!==(s=t.tenantId)&&void 0!==s?s:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,r){return new Lt(t,e,n,r)}}function Pt(t,e,n,r){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Lt._fromErrorAndOperation(t,n,e,r);throw n}))}async function Mt(t,e,n=!1){const r=await j(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Rt._forOperation(t,"link",r)}async function xt(t,e,n=!1){var r;const{auth:s}=t,i="reauthenticate";try{const r=await j(t,Pt(s,i,e,t),n);y(r.idToken,s,"internal-error");const o=F(r.idToken);y(o,s,"internal-error");const{sub:a}=o;return y(t.uid===a,s,"user-mismatch"),Rt._forOperation(t,i,r)}catch(o){throw"auth/user-not-found"===(null===(r=o)||void 0===r?void 0:r.code)&&f(s,"user-mismatch"),o}}async function Ut(t,e,n=!1){const r="signIn",s=await Pt(t,r,e),i=await Rt._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function Vt(t,e){return Ut(ht(t),e)}async function Ft(t,e,n){const r=ht(t),s=await Dt(r,{returnSecureToken:!0,email:e,password:n}),i=await Rt._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(i.user),i}function jt(t,e,n){return Vt((0,r.m9)(t),Et.credential(e,n))}async function qt(t,{displayName:e,photoURL:n}){if(void 0===e&&void 0===n)return;const s=(0,r.m9)(t),i={idToken:await s.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await j(s,async function(t,e){return R(t,"POST","/v1/accounts:update",e)}(s.auth,i));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find((({providerId:t})=>"password"===t));a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function Bt(t,e,n,s){return(0,r.m9)(t).onAuthStateChanged(e,n,s)}new WeakMap;const zt="__sak";class $t{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(zt,"1"),this.storage.removeItem(zt),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Kt extends $t{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=(0,r.z$)();return Z(t)||it(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=ot(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),r=this.localCache[e];n!==r&&t(e,r,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(t.newValue!==r)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const s=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},i=this.storage.getItem(n);(0,r.w1)()&&10===document.documentMode&&i!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,10):s()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const r of Array.from(n))r(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Kt.type="LOCAL";const Ht=Kt;class Gt extends $t{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Gt.type="SESSION";const Wt=Gt;class Qt{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Qt(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:r,data:s}=e.data,i=this.handlersMap[r];if(!(null===i||void 0===i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map((async t=>t(e.origin,s))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Xt(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(10*Math.random());return t+n}Qt.receivers=[];class Jt{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise(((o,a)=>{const c=Xt("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);i={messageChannel:r,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(e.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[r.port2])})).finally((()=>{i&&this.removeMessageHandler(i)}))}}function Yt(){return window}function Zt(){return"undefined"!==typeof Yt().WorkerGlobalScope&&"function"===typeof Yt().importScripts}const te="firebaseLocalStorageDb",ee="firebaseLocalStorage",ne="fbase_key";class re{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function se(t,e){return t.transaction([ee],e?"readwrite":"readonly").objectStore(ee)}function ie(){const t=indexedDB.open(te,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(ee,{keyPath:ne})}catch(r){n(r)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(ee)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(te);return new re(t).toPromise()}(),e(await ie()))}))}))}async function oe(t,e,n){const r=se(t,!0).put({[ne]:e,value:n});return new re(r).toPromise()}function ae(t,e){const n=se(t,!0).delete(e);return new re(n).toPromise()}class ce{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await ie()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(n){if(e++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Zt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qt._getInstance(Zt()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new Jt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(this.sender&&this.activeServiceWorker&&function(){var t;return(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await ie();return await oe(t,zt,"1"),await ae(t,zt),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>oe(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=se(t,!1).get(e),r=await new re(n).toPromise();return void 0===r?null:r.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>ae(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=se(t,!1).getAll();return new re(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:r,value:s}of t)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),e.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),e.push(r));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const r of Array.from(n))r(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ce.type="LOCAL";const ue=ce;function he(t){return new Promise(((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=t=>{const e=p("internal-error");e.customData=t,n(e)},r.type="text/javascript",r.charset="UTF-8",function(){var t,e;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}))}function le(t){return`__${t}${Math.floor(1e6*Math.random())}`}le("rcb"),new S(3e4,6e4);const de="recaptcha";async function fe(t,e,n){var r;const s=await n.verify();try{let i;if(y("string"===typeof s,t,"argument-error"),y(n.type===de,t,"argument-error"),i="string"===typeof e?{phoneNumber:e}:e,"session"in i){const e=i.session;if("phoneNumber"in i){y("enroll"===e.type,t,"internal-error");const n=await function(t,e){return R(t,"POST","/v2/accounts/mfaEnrollment:start",D(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{y("signin"===e.type,t,"internal-error");const n=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;y(n,t,"missing-multi-factor-info");const o=await function(t,e){return R(t,"POST","/v2/accounts/mfaSignIn:start",D(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return R(t,"POST","/v1/accounts:sendVerificationCode",D(t,e))}(t,{phoneNumber:i.phoneNumber,recaptchaToken:s});return e}}finally{n._reset()}}class pe{constructor(t){this.providerId=pe.PROVIDER_ID,this.auth=ht(t)}verifyPhoneNumber(t,e){return fe(this.auth,t,(0,r.m9)(e))}static credential(t,e){return Tt._fromVerification(t,e)}static credentialFromResult(t){const e=t;return pe.credentialFromTaggedObject(e)}static credentialFromError(t){return pe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?Tt._fromTokenResponse(e,n):null}}function me(t,e){return e?T(e):(y(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}pe.PROVIDER_ID="phone",pe.PHONE_SIGN_IN_METHOD="phone";class ge extends mt{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return vt(t,this._buildIdpRequest())}_linkToIdToken(t,e){return vt(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return vt(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function ye(t){return Ut(t.auth,new ge(t),t.bypassAuthState)}function ve(t){const{auth:e,user:n}=t;return y(n,e,"internal-error"),xt(n,new ge(t),t.bypassAuthState)}async function we(t){const{auth:e,user:n}=t;return y(n,e,"internal-error"),Mt(n,new ge(t),t.bypassAuthState)}class Ie{constructor(t,e,n,r,s=!1){this.auth=t,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=t;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return ye;case"linkViaPopup":case"linkViaRedirect":return we;case"reauthViaPopup":case"reauthViaRedirect":return ve;default:f(this.auth,"internal-error")}}resolve(t){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Te=new S(2e3,1e4);class be extends Ie{constructor(t,e,n,r,s){super(t,e,r,s),this.provider=n,this.authWindow=null,this.pollId=null,be.currentPopupAction&&be.currentPopupAction.cancel(),be.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return y(t,this.auth,"internal-error"),t}async onExecution(){w(1===this.filter.length,"Popup operations only handle one event");const t=Xt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(p(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,be.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(t,Te.get())};t()}}be.currentPopupAction=null;const Ee=new Map;class _e extends Ie{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=Ee.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=Ce(e),r=ke(t);if(!(await r._isAvailable()))return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}Ee.set(this.auth._key(),t)}return this.bypassAuthState||Ee.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Se(t,e){Ee.set(t._key(),e)}function ke(t){return T(t._redirectPersistence)}function Ce(t){return Q("pendingRedirect",t.config.apiKey,t.name)}async function Ae(t,e,n=!1){const r=ht(t),s=me(r,e),i=new _e(r,s,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}class Ne{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Re(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Re(t)){const r=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(p(this.auth,r))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(De(t))}saveEventToCache(t){this.cachedEventUids.add(De(t)),this.lastProcessedEventTime=Date.now()}}function De(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Re({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null===e||void 0===e?void 0:e.code)}const Oe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Le=/^https?/;async function Pe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return R(t,"GET","/v1/projects",e)}(t);for(const r of e)try{if(Me(r))return}catch(n){}f(t,"unauthorized-domain")}function Me(t){const e=b(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const s=new URL(t);return""===s.hostname&&""===r?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!Le.test(n))return!1;if(Oe.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const xe=new S(3e4,6e4);function Ue(){const t=Yt().___jsl;if(null===t||void 0===t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}let Ve=null;function Fe(t){return Ve=Ve||function(t){return new Promise(((e,n)=>{var r,s,i;function o(){Ue(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ue(),n(p(t,"network-request-failed"))},timeout:xe.get()})}if(null===(s=null===(r=Yt().gapi)||void 0===r?void 0:r.iframes)||void 0===s?void 0:s.Iframe)e(gapi.iframes.getContext());else{if(!(null===(i=Yt().gapi)||void 0===i?void 0:i.load)){const e=le("iframefcb");return Yt()[e]=()=>{gapi.load?o():n(p(t,"network-request-failed"))},he(`https://apis.google.com/js/api.js?onload=${e}`).catch((t=>n(t)))}o()}})).catch((t=>{throw Ve=null,t}))}(t),Ve}const je=new S(5e3,15e3),qe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Be=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ze(t){const e=t.config;y(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?k(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:t.name,v:s.Jn},o=Be.get(t.config.apiHost);o&&(i.eid=o);const a=t._getFrameworks();return a.length&&(i.fw=a.join(",")),`${n}?${(0,r.xO)(i).slice(1)}`}const $e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ke{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function He(t,e,n,s=500,i=600){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let c="";const u=Object.assign(Object.assign({},$e),{width:s.toString(),height:i.toString(),top:o,left:a}),h=(0,r.z$)().toLowerCase();n&&(c=tt(h)?"_blank":n),Y(h)&&(e=e||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=(0,r.z$)()){var e;return it(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(h)&&"_self"!==c)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(e||"",c),new Ke(null);const d=window.open(e||"",c,l);y(d,t,"popup-blocked");try{d.focus()}catch(f){}return new Ke(d)}const Ge="__/auth/handler",We="emulator/auth/handler";function Qe(t,e,n,i,o,a){y(t.config.authDomain,t,"auth-domain-config-required"),y(t.config.apiKey,t,"invalid-api-key");const c={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:s.Jn,eventId:o};if(e instanceof _t){e.setDefaultLanguage(t.languageCode),c.providerId=e.providerId||"",(0,r.xb)(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(a||{}))c[t]=e}if(e instanceof St){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(c.scopes=t.join(","))}t.tenantId&&(c.tid=t.tenantId);const u=c;for(const r of Object.keys(u))void 0===u[r]&&delete u[r];return`${function({config:t}){if(!t.emulator)return`https://${t.authDomain}/${Ge}`;return k(t,We)}(t)}?${(0,r.xO)(u).slice(1)}`}const Xe="webStorageSupport";const Je=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wt,this._completeRedirectFn=Ae,this._overrideRedirectResult=Se}async _openPopup(t,e,n,r){var s;w(null===(s=this.eventManagers[t._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return He(t,Qe(t,e,n,b(),r),Xt())}async _openRedirect(t,e,n,r){var s;return await this._originValidation(t),s=Qe(t,e,n,b(),r),Yt().location.href=s,new Promise((()=>{}))}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(w(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await Fe(t),n=Yt().gapi;return y(n,t,"internal-error"),e.open({where:document.body,url:ze(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qe,dontclear:!0},(e=>new Promise((async(n,r)=>{await e.restyle({setHideOnLeave:!1});const s=p(t,"network-request-failed"),i=Yt().setTimeout((()=>{r(s)}),je.get());function o(){Yt().clearTimeout(i),n(e)}e.ping(o).then(o,(()=>{r(s)}))}))))}(t),n=new Ne(t);return e.register("authEvent",(e=>{y(null===e||void 0===e?void 0:e.authEvent,t,"invalid-auth-event");return{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Xe,{type:Xe},(n=>{var r;const s=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==s&&e(!!s),f(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=Pe(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return ot()||Z()||it()}};var Ye="@firebase/auth",Ze="0.20.11";class tn{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(t)}}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{var n;t((null===(n=e)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const en=(0,r.Pz)("authIdTokenMaxAge")||300;let nn=null;function rn(t=(0,s.Mq)()){const e=(0,s.qX)(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=(0,s.qX)(t,"auth");if(n.isInitialized()){const t=n.getImmediate(),s=n.getOptions();if((0,r.vZ)(s,null!==e&&void 0!==e?e:{}))return t;f(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:Je,persistence:[ue,Ht,Wt]}),i=(0,r.Pz)("authTokenSyncURL");if(i){const t=(o=i,async t=>{const e=t&&await t.getIdTokenResult(),n=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>en)return;const r=null===e||void 0===e?void 0:e.token;nn!==r&&(nn=r,await fetch(o,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(t,e,n){(0,r.m9)(t).beforeAuthStateChanged(e,n)}(n,t,(()=>t(n.currentUser))),function(t,e,n,s){(0,r.m9)(t).onIdTokenChanged(e,n,s)}(n,(e=>t(e)))}var o;const a=(0,r.q4)("auth");return a&&dt(n,`http://${a}`),n}var sn;sn="Browser",(0,s.Xd)(new a.wA("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),{apiKey:s,authDomain:i}=n.options;return((t,n)=>{y(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),y(!(null===i||void 0===i?void 0:i.includes(":")),"argument-error",{appName:t.name});const r={apiKey:s,authDomain:i,clientPlatform:sn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:at(sn)},o=new ut(t,n,r);return function(t,e){const n=(null===e||void 0===e?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(T);(null===e||void 0===e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,null===e||void 0===e?void 0:e.popupRedirectResolver)}(o,e),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),(0,s.Xd)(new a.wA("auth-internal",(t=>(t=>new tn(t))(ht(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.KN)(Ye,Ze,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(sn)),(0,s.KN)(Ye,Ze,"esm2017")},5321:function(t,e,n){"use strict";n.d(e,{ET:function(){return Xh},Ab:function(){return el},vr:function(){return tl},hJ:function(){return Mu},at:function(){return Ru},oe:function(){return Qh},JU:function(){return xu},PL:function(){return Hh},ad:function(){return Xu},LV:function(){return Qu},cf:function(){return Jh},IO:function(){return Oh},pl:function(){return Gh},r7:function(){return Wh},ar:function(){return Ph}});var r,s=n(5816),i=n(8463),o=n(3333),a=n(4444),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},u={},h=h||{},l=c||self;function d(){}function f(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var m="closure_uid_"+(1e9*Math.random()>>>0),g=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function v(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function w(t,e,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function I(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function T(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Wb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function b(){this.s=this.s,this.o=this.o}b.prototype.s=!1,b.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,m)&&t[m]||(t[m]=++g))},b.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function _(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function S(t,e){for(let n=1;n<arguments.length;n++){const e=arguments[n];if(f(e)){const n=t.length||0,r=e.length||0;t.length=n+r;for(let s=0;s<r;s++)t[n+s]=e[s]}else t.push(e)}}function k(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",d,e),l.removeEventListener("test",d,e)}catch(n){}return t}();function A(t){return/^[\s\xa0]*$/.test(t)}var N=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function D(t,e){return t<e?-1:t>e?1:0}function R(){var t=l.navigator;return t&&(t=t.userAgent)?t:""}function O(t){return-1!=R().indexOf(t)}function L(t){return L[" "](t),t}L[" "]=d;var P,M=O("Opera"),x=O("Trident")||O("MSIE"),U=O("Edge"),V=U||x,F=O("Gecko")&&!(-1!=R().toLowerCase().indexOf("webkit")&&!O("Edge"))&&!(O("Trident")||O("MSIE"))&&!O("Edge"),j=-1!=R().toLowerCase().indexOf("webkit")&&!O("Edge");function q(){var t=l.document;return t?t.documentMode:void 0}t:{var B="",z=function(){var t=R();return F?/rv:([^\);]+)(\)|;)/.exec(t):U?/Edge\/([\d\.]+)/.exec(t):x?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):j?/WebKit\/(\S+)/.exec(t):M?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(z&&(B=z?z[1]:""),x){var $=q();if(null!=$&&$>parseFloat(B)){P=String($);break t}}P=B}var K,H={};function G(){return function(t){var e=H;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}((function(){let t=0;const e=N(String(P)).split("."),n=N("9").split("."),r=Math.max(e.length,n.length);for(let o=0;0==t&&o<r;o++){var s=e[o]||"",i=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;t=D(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||D(0==s[2].length,0==i[2].length)||D(s[2],i[2]),s=s[3],i=i[3]}while(0==t)}return 0<=t}))}if(l.document&&x){var W=q();K=W||(parseInt(P,10)||void 0)}else K=void 0;var Q=K;function X(t,e){if(k.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(F){t:{try{L(e.nodeName);var s=!0;break t}catch(i){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"===typeof t.pointerType?t.pointerType:J[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&X.X.h.call(this)}}T(X,k);var J={2:"touch",3:"pen",4:"mouse"};X.prototype.h=function(){X.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Y="closure_listenable_"+(1e6*Math.random()|0),Z=0;function tt(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=s,this.key=++Z,this.ba=this.ea=!1}function et(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function nt(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function rt(t){const e={};for(const n in t)e[n]=t[n];return e}const st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)t[n]=r[n];for(let e=0;e<st.length;e++)n=st[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){this.src=t,this.g={},this.h=0}function at(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=E(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(et(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ct(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ba&&i.listener==e&&i.capture==!!n&&i.ha==r)return s}return-1}ot.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=ct(t,e,r,s);return-1<o?(e=t[o],n||(e.ea=!1)):((e=new tt(e,this.src,i,!!r,s)).ea=n,t.push(e)),e};var ut="closure_lm_"+(1e6*Math.random()|0),ht={};function lt(t,e,n,r,s){if(r&&r.once)return ft(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)lt(t,e[i],n,r,s);return null}return n=It(n),t&&t[Y]?t.N(e,n,p(r)?!!r.capture:!!r,s):dt(t,e,n,!1,r,s)}function dt(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=p(s)?!!s.capture:!!s,a=vt(t);if(a||(t[ut]=a=new ot(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=yt;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)C||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(gt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ft(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ft(t,e[i],n,r,s);return null}return n=It(n),t&&t[Y]?t.O(e,n,p(r)?!!r.capture:!!r,s):dt(t,e,n,!0,r,s)}function pt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)pt(t,e[i],n,r,s);else r=p(r)?!!r.capture:!!r,n=It(n),t&&t[Y]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=ct(i=t.g[e],n,r,s))&&(et(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--)))):t&&(t=vt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ct(e,n,r,s)),(n=-1<t?e[t]:null)&&mt(n))}function mt(t){if("number"!==typeof t&&t&&!t.ba){var e=t.src;if(e&&e[Y])at(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(gt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=vt(e))?(at(n,t),0==n.h&&(n.src=null,e[ut]=null)):et(t)}}}function gt(t){return t in ht?ht[t]:ht[t]="on"+t}function yt(t,e){if(t.ba)t=!0;else{e=new X(e,this);var n=t.listener,r=t.ha||t.src;t.ea&&mt(t),t=n.call(r,e)}return t}function vt(t){return(t=t[ut])instanceof ot?t:null}var wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function It(t){return"function"===typeof t?t:(t[wt]||(t[wt]=function(e){return t.handleEvent(e)}),t[wt])}function Tt(){b.call(this),this.i=new ot(this),this.P=this,this.I=null}function bt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"===typeof e)e=new k(e,t);else if(e instanceof k)e.target=e.target||t;else{var s=e;it(e=new k(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Et(o,r,!0,e)&&s}if(s=Et(o=e.g=t,r,!0,e)&&s,s=Et(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Et(o=e.g=n[i],r,!1,e)&&s}function Et(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&at(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}T(Tt,b),Tt.prototype[Y]=!0,Tt.prototype.removeEventListener=function(t,e,n,r){pt(this,t,e,n,r)},Tt.prototype.M=function(){if(Tt.X.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)et(n[r]);delete e.g[t],e.h--}}this.I=null},Tt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Tt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var _t=l.JSON.stringify;function St(){var t=Ot;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var kt,Ct=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new At),(t=>t.reset()));class At{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Nt(t){l.setTimeout((()=>{throw t}),0)}function Dt(t,e){kt||function(){var t=l.Promise.resolve(void 0);kt=function(){t.then(Lt)}}(),Rt||(kt(),Rt=!0),Ot.add(t,e)}var Rt=!1,Ot=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ct.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Lt(){for(var t;t=St();){try{t.h.call(t.g)}catch(n){Nt(n)}var e=Ct;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Rt=!1}function Pt(t,e){Tt.call(this),this.h=t||1,this.g=e||l,this.j=w(this.lb,this),this.l=Date.now()}function Mt(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}function xt(t,e,n){if("function"===typeof t)n&&(t=w(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=w(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function Ut(t){t.g=xt((()=>{t.g=null,t.i&&(t.i=!1,Ut(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}T(Pt,Tt),(r=Pt.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),bt(this,"tick"),this.ca&&(Mt(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Pt.X.M.call(this),Mt(this),delete this.g};class Vt extends b{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ut(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ft(t){b.call(this),this.h=t,this.g={}}T(Ft,b);var jt=[];function qt(t,e,n,r){Array.isArray(n)||(n&&(jt[0]=n.toString()),n=jt);for(var s=0;s<n.length;s++){var i=lt(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Bt(t){nt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&mt(t)}),t),t.g={}}function zt(){this.g=!0}function $t(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return _t(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Ft.prototype.M=function(){Ft.X.M.call(this),Bt(this)},Ft.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},zt.prototype.Aa=function(){this.g=!1},zt.prototype.info=function(){};var Kt={},Ht=null;function Gt(){return Ht=Ht||new Tt}function Wt(t){k.call(this,Kt.Pa,t)}function Qt(t){const e=Gt();bt(e,new Wt(e))}function Xt(t,e){k.call(this,Kt.STAT_EVENT,t),this.stat=e}function Jt(t){const e=Gt();bt(e,new Xt(e,t))}function Yt(t,e){k.call(this,Kt.Qa,t),this.size=e}function Zt(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}Kt.Pa="serverreachability",T(Wt,k),Kt.STAT_EVENT="statevent",T(Xt,k),Kt.Qa="timingevent",T(Yt,k);var te={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ee={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ne(){}function re(t){return t.h||(t.h=t.i())}function se(){}ne.prototype.h=null;var ie,oe={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ae(){k.call(this,"d")}function ce(){k.call(this,"c")}function ue(){}function he(t,e,n,r){this.l=t,this.j=e,this.m=n,this.U=r||1,this.S=new Ft(this),this.O=de,t=V?125:void 0,this.T=new Pt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new le}function le(){this.i=null,this.g="",this.h=!1}T(ae,k),T(ce,k),T(ue,ne),ue.prototype.g=function(){return new XMLHttpRequest},ue.prototype.i=function(){return{}},ie=new ue;var de=45e3,fe={},pe={};function me(t,e,n){t.K=1,t.v=Pe(Ne(e)),t.s=n,t.P=!0,ge(t,null)}function ge(t,e){t.F=Date.now(),Ie(t),t.A=Ne(t.v);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),Ge(n.i,"t",r),t.C=0,n=t.l.H,t.h=new le,t.g=Wn(t.l,n?e:null,!t.s),0<t.N&&(t.L=new Vt(w(t.La,t,t.g),t.N)),qt(t.S,t.g,"readystatechange",t.ib),e=t.H?rt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),Qt(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.U,t.s)}function ye(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Da)}function ve(t,e,n){let r,s=!0;for(;!t.I&&t.C<n.length;){if(r=we(t,n),r==pe){4==e&&(t.o=4,Jt(14),s=!1),$t(t.j,t.m,null,"[Incomplete Response]");break}if(r==fe){t.o=4,Jt(15),$t(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}$t(t.j,t.m,r,null),Se(t,r)}ye(t)&&r!=pe&&r!=fe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Jt(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.$&&(t.$=!0,(e=t.l).g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),jn(e),e.K=!0,Jt(11))):($t(t.j,t.m,n,"[Invalid Chunked Response]"),_e(t),Ee(t))}function we(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?pe:(n=Number(e.substring(n,r)),isNaN(n)?fe:(r+=1)+n>e.length?pe:(e=e.substr(r,n),t.C=r+n,e))}function Ie(t){t.V=Date.now()+t.O,Te(t,t.O)}function Te(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Zt(w(t.gb,t),e)}function be(t){t.B&&(l.clearTimeout(t.B),t.B=null)}function Ee(t){0==t.l.G||t.I||zn(t.l,t)}function _e(t){be(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Mt(t.T),Bt(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Se(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||tn(n.h,t)))if(!t.J&&tn(n.h,t)&&3==n.G){try{var r=n.Fa.g.parse(e)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Bn(n),On(n)}Fn(n),Jt(18)}}else n.Ba=s[1],0<n.Ba-n.T&&37500>s[2]&&n.L&&0==n.A&&!n.v&&(n.v=Zt(w(n.cb,n),6e3));if(1>=Ze(n.h)&&n.ja){try{n.ja()}catch(u){}n.ja=void 0}}else Kn(n,11)}else if((t.J||n.g==t)&&Bn(n),!A(e))for(s=n.Fa.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const e=u[3];null!=e&&(n.ma=e,n.j.info("VER="+n.ma));const s=u[4];null!=s&&(n.Ca=s,n.j.info("SVER="+n.Ca));const h=u[5];null!=h&&"number"===typeof h&&0<h&&(r=1.5*h,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(en(i,i.h),i.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.za=t,Le(r.F,r.D,t))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=t;if((r=n).sa=Gn(r,r.H?r.ka:null,r.V),o.J){nn(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&(be(a),Ie(a)),r.g=o}else Vn(r);0<n.i.length&&Pn(n)}else"stop"!=u[0]&&"close"!=u[0]||Kn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Kn(n,7):Rn(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}Qt()}catch(u){}}function ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||"string"===typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.oa&&"function"==typeof t.oa)return t.oa();if(!t.W||"function"!=typeof t.W){if("undefined"!==typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!==typeof Set&&t instanceof Set)){if(f(t)||"string"===typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.W&&"function"==typeof t.W)return t.W();if("undefined"!==typeof Map&&t instanceof Map||"undefined"!==typeof Set&&t instanceof Set)return Array.from(t.values());if("string"===typeof t)return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(r=he.prototype).setTimeout=function(t){this.O=t},r.ib=function(t){t=t.target;const e=this.L;e&&3==Sn(t)?e.l():this.La(t)},r.La=function(t){try{if(t==this.g)t:{const h=Sn(this.g);var e=this.g.Ea();this.g.aa();if(!(3>h)&&(3!=h||V||this.g&&(this.h.h||this.g.fa()||kn(this.g)))){this.I||4!=h||7==e||Qt(),be(this);var n=this.g.aa();this.Y=n;e:if(ye(this)){var r=kn(this.g);t="";var s=r.length,i=4==Sn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){_e(this),Ee(this);var o="";break e}this.h.i=new l.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.U,h,n),this.i){if(this.Z&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,Jt(12),_e(this),Ee(this);break t}$t(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Se(this,n)}this.P?(ve(this,h,o),V&&this.i&&3==h&&(qt(this.S,this.T,"tick",this.hb),this.T.start())):($t(this.j,this.m,o,null),Se(this,o)),4==h&&_e(this),this.i&&!this.I&&(4==h?zn(this.l,this):(this.i=!1,Ie(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Jt(12)):(this.o=0,Jt(13)),_e(this),Ee(this)}}}catch(h){}},r.hb=function(){if(this.g){var t=Sn(this.g),e=this.g.fa();this.C<e.length&&(be(this),ve(this,t,e),this.i&&4!=t&&Ie(this))}},r.cancel=function(){this.I=!0,_e(this)},r.gb=function(){this.B=null;const t=Date.now();0<=t-this.V?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Qt(),Jt(17)),_e(this),this.o=2,Ee(this)):Te(this,this.V-t)};var Ce=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ae(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Ae){this.h=void 0!==e?e:t.h,De(this,t.j),this.s=t.s,this.g=t.g,Re(this,t.m),this.l=t.l,e=t.i;var n=new ze;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Oe(this,n),this.o=t.o}else t&&(n=String(t).match(Ce))?(this.h=!!e,De(this,n[1]||"",!0),this.s=Me(n[2]||""),this.g=Me(n[3]||"",!0),Re(this,n[4]),this.l=Me(n[5]||"",!0),Oe(this,n[6]||"",!0),this.o=Me(n[7]||"")):(this.h=!!e,this.i=new ze(null,this.h))}function Ne(t){return new Ae(t)}function De(t,e,n){t.j=n?Me(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Re(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Oe(t,e,n){e instanceof ze?(t.i=e,function(t,e){e&&!t.j&&($e(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ke(this,e),Ge(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=xe(e,qe)),t.i=new ze(e,t.h))}function Le(t,e,n){t.i.set(e,n)}function Pe(t){return Le(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Me(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function xe(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,Ue),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ue(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ae.prototype.toString=function(){var t=[],e=this.j;e&&t.push(xe(e,Ve,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(xe(e,Ve,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(xe(n,"/"==n.charAt(0)?je:Fe,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",xe(n,Be)),t.join("")};var Ve=/[#\/\?@]/g,Fe=/[#\?:]/g,je=/[#\?]/g,qe=/[#\?@]/g,Be=/#/g;function ze(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function $e(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ke(t,e){$e(t),e=We(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function He(t,e){return $e(t),e=We(t,e),t.g.has(e)}function Ge(t,e,n){Ke(t,e),0<n.length&&(t.i=null,t.g.set(We(t,e),_(n)),t.h+=n.length)}function We(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(r=ze.prototype).add=function(t,e){$e(this),this.i=null,t=We(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},r.forEach=function(t,e){$e(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},r.oa=function(){$e(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},r.W=function(t){$e(this);let e=[];if("string"===typeof t)He(this,t)&&(e=e.concat(this.g.get(We(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},r.set=function(t,e){return $e(this),this.i=null,He(this,t=We(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},r.get=function(t,e){return t&&0<(t=this.W(t)).length?String(t[0]):e},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};function Qe(t){this.l=t||Je,l.PerformanceNavigationTiming?t=0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(l.g&&l.g.Ga&&l.g.Ga()&&l.g.Ga().$b),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Xe,Je=10;function Ye(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ze(t){return t.h?1:t.g?t.g.size:0}function tn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function en(t,e){t.g?t.g.add(e):t.h=e}function nn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function rn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return _(t.i)}function sn(){}function on(){this.g=new sn}function an(t,e,n){const r=n||"";try{ke(t,(function(t,n){let s=t;p(t)&&(s=_t(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function cn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function un(t){this.l=t.ac||null,this.j=t.jb||!1}function hn(t,e){Tt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=ln,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Qe.prototype.cancel=function(){if(this.i=rn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},sn.prototype.stringify=function(t){return l.JSON.stringify(t,void 0)},sn.prototype.parse=function(t){return l.JSON.parse(t,void 0)},T(un,ne),un.prototype.g=function(){return new hn(this.l,this.j)},un.prototype.i=(Xe={},function(){return Xe}),T(hn,Tt);var ln=0;function dn(t){t.j.read().then(t.Ta.bind(t)).catch(t.ga.bind(t))}function fn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,pn(t)}function pn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=hn.prototype).open=function(t,e){if(this.readyState!=ln)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,pn(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||l).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,fn(this)),this.readyState=ln},r.Wa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,pn(this)),this.g&&(this.readyState=3,pn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if("undefined"!==typeof l.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;dn(this)}else t.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?fn(this):pn(this),3==this.readyState&&dn(this)}},r.Va=function(t){this.g&&(this.response=this.responseText=t,fn(this))},r.Ua=function(t){this.g&&(this.response=t,fn(this))},r.ga=function(){this.g&&fn(this)},r.setRequestHeader=function(t,e){this.v.append(t,e)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(hn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var mn=l.JSON.parse;function gn(t){Tt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=yn,this.K=this.L=!1}T(gn,Tt);var yn="",vn=/^https?$/i,wn=["POST","PUT"];function In(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Tn(t),En(t)}function Tn(t){t.D||(t.D=!0,bt(t,"complete"),bt(t,"error"))}function bn(t){if(t.h&&"undefined"!=typeof h&&(!t.C[1]||4!=Sn(t)||2!=t.aa()))if(t.v&&4==Sn(t))xt(t.Ha,0,t);else if(bt(t,"readystatechange"),4==Sn(t)){t.h=!1;try{const c=t.aa();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===c){var s=String(t.H).match(Ce)[1]||null;if(!s&&l.self&&l.self.location){var i=l.self.location.protocol;s=i.substr(0,i.length-1)}r=!vn.test(s?s.toLowerCase():"")}n=r}if(n)bt(t,"complete"),bt(t,"success");else{t.m=6;try{var o=2<Sn(t)?t.g.statusText:""}catch(a){o=""}t.j=o+" ["+t.aa()+"]",Tn(t)}}finally{En(t)}}}function En(t,e){if(t.g){_n(t);const r=t.g,s=t.C[0]?d:null;t.g=null,t.C=null,e||bt(t,"ready");try{r.onreadystatechange=s}catch(n){}}}function _n(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(l.clearTimeout(t.A),t.A=null)}function Sn(t){return t.g?t.g.readyState:0}function kn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case yn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(hr){return null}}function Cn(t){let e="";return nt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function An(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Cn(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):Le(t,e,n))}function Nn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Dn(t){this.Ca=0,this.i=[],this.j=new zt,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Nn("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Nn("baseRetryDelayMs",5e3,t),this.bb=Nn("retryDelaySeedMs",1e4,t),this.$a=Nn("forwardChannelMaxRetries",2,t),this.ta=Nn("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Zb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new Qe(t&&t.concurrentRequestLimit),this.Fa=new on,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=t&&t.Xb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Rn(t){if(Ln(t),3==t.G){var e=t.U++,n=Ne(t.F);Le(n,"SID",t.I),Le(n,"RID",e),Le(n,"TYPE","terminate"),xn(t,n),(e=new he(t,t.j,e,void 0)).K=2,e.v=Pe(Ne(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(e.v.toString(),"")),!n&&l.Image&&((new Image).src=e.v,n=!0),n||(e.g=Wn(e.l,null),e.g.da(e.v)),e.F=Date.now(),Ie(e)}Hn(t)}function On(t){t.g&&(jn(t),t.g.cancel(),t.g=null)}function Ln(t){On(t),t.u&&(l.clearTimeout(t.u),t.u=null),Bn(t),t.h.cancel(),t.m&&("number"===typeof t.m&&l.clearTimeout(t.m),t.m=null)}function Pn(t){Ye(t.h)||t.m||(t.m=!0,Dt(t.Ja,t),t.C=0)}function Mn(t,e){var n;n=e?e.m:t.U++;const r=Ne(t.F);Le(r,"SID",t.I),Le(r,"RID",n),Le(r,"AID",t.T),xn(t,r),t.o&&t.s&&An(r,t.o,t.s),n=new he(t,t.j,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=Un(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),en(t.h,n),me(n,r,e)}function xn(t,e){t.ia&&nt(t.ia,(function(t,n){Le(e,n,t)})),t.l&&ke({},(function(t,n){Le(e,n,t)}))}function Un(t,e,n){n=Math.min(t.i.length,n);var r=t.l?w(t.l.Ra,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let o=!0;for(let a=0;a<n;a++){let n=s[a].h;const c=s[a].g;if(n-=e,0>n)e=Math.max(0,s[a].h-100),o=!1;else try{an(c,t,"req"+n+"_")}catch(i){r&&r(c)}}if(o){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function Vn(t){t.g||t.u||(t.Z=1,Dt(t.Ia,t),t.A=0)}function Fn(t){return!(t.g||t.u||3<=t.A)&&(t.Z++,t.u=Zt(w(t.Ia,t),$n(t,t.A)),t.A++,!0)}function jn(t){null!=t.B&&(l.clearTimeout(t.B),t.B=null)}function qn(t){t.g=new he(t,t.j,"rpc",t.Z),null===t.o&&(t.g.H=t.s),t.g.N=0;var e=Ne(t.sa);Le(e,"RID","rpc"),Le(e,"SID",t.I),Le(e,"CI",t.L?"0":"1"),Le(e,"AID",t.T),Le(e,"TYPE","xmlhttp"),xn(t,e),t.o&&t.s&&An(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=Pe(Ne(e)),n.s=null,n.P=!0,ge(n,t)}function Bn(t){null!=t.v&&(l.clearTimeout(t.v),t.v=null)}function zn(t,e){var n=null;if(t.g==e){Bn(t),jn(t),t.g=null;var r=2}else{if(!tn(t.h,e))return;n=e.D,nn(t.h,e),r=1}if(0!=t.G)if(t.pa=e.Y,e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;bt(r=Gt(),new Yt(r,n)),Pn(t)}else Vn(t);else if(3==(s=e.o)||0==s&&0<t.pa||!(1==r&&function(t,e){return!(Ze(t.h)>=t.h.j-(t.m?1:0))&&(t.m?(t.i=e.D.concat(t.i),!0):!(1==t.G||2==t.G||t.C>=(t.Za?0:t.$a))&&(t.m=Zt(w(t.Ja,t,e),$n(t,t.C)),t.C++,!0))}(t,e)||2==r&&Fn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:Kn(t,5);break;case 4:Kn(t,10);break;case 3:Kn(t,6);break;default:Kn(t,2)}}function $n(t,e){let n=t.Xa+Math.floor(Math.random()*t.bb);return t.l||(n*=2),n*e}function Kn(t,e){if(t.j.info("Error code "+e),2==e){var n=null;t.l&&(n=null);var r=w(t.kb,t);n||(n=new Ae("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||De(n,"https"),Pe(n)),function(t,e){const n=new zt;if(l.Image){const r=new Image;r.onload=I(cn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=I(cn,n,r,"TestLoadImage: error",!1,e),r.onabort=I(cn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=I(cn,n,r,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Jt(2);t.G=0,t.l&&t.l.va(e),Hn(t),Ln(t)}function Hn(t){if(t.G=0,t.la=[],t.l){const e=rn(t.h);0==e.length&&0==t.i.length||(S(t.la,e),S(t.la,t.i),t.h.i.length=0,_(t.i),t.i.length=0),t.l.ua()}}function Gn(t,e,n){var r=n instanceof Ae?Ne(n):new Ae(n,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Re(r,r.m);else{var s=l.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Ae(null,void 0);r&&De(i,r),e&&(i.g=e),s&&Re(i,s),n&&(i.l=n),r=i}return n=t.D,e=t.za,n&&e&&Le(r,n,e),Le(r,"VER",t.ma),xn(t,r),r}function Wn(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Da&&!t.ra?new gn(new un({jb:!0})):new gn(t.ra)).Ka(t.H),e}function Qn(){}function Xn(){if(x&&!(10<=Number(Q)))throw Error("Environmental error: no available transport.")}function Jn(t,e){Tt.call(this),this.g=new Dn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Yb)&&!A(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!A(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new tr(this)}function Yn(t){ae.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Zn(){ce.call(this),this.status=1}function tr(t){this.g=t}(r=gn.prototype).Ka=function(t){this.L=t},r.da=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ie.g(),this.C=this.u?re(this.u):re(ie),this.g.onreadystatechange=w(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(i){return void In(this,i)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=l.FormData&&t instanceof l.FormData,!(0<=E(wn,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,a]of n)this.g.setRequestHeader(o,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{_n(this),0<this.B&&((this.K=function(t){return x&&G()&&"number"===typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=w(this.qa,this)):this.A=xt(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){In(this,i)}},r.qa=function(){"undefined"!=typeof h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,bt(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,bt(this,"complete"),bt(this,"abort"),En(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),En(this,!0)),gn.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?bn(this):this.fb())},r.fb=function(){bn(this)},r.aa=function(){try{return 2<Sn(this)?this.g.status:-1}catch(Xe){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(Xe){return""}},r.Sa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),mn(e)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=Dn.prototype).ma=8,r.G=1,r.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new he(this,this.j,t,void 0);let i=this.s;if(this.S&&(i?(i=rt(i),it(i,this.S)):i=this.S),null!==this.o||this.N||(s.H=i,i=null),this.O)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"===typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Un(this,s,e),Le(n=Ne(this.F),"RID",t),Le(n,"CVER",22),this.D&&Le(n,"X-HTTP-Session-Id",this.D),xn(this,n),i&&(this.N?e="headers="+encodeURIComponent(String(Cn(i)))+"&"+e:this.o&&An(n,this.o,i)),en(this.h,s),this.Ya&&Le(n,"TYPE","init"),this.O?(Le(n,"$req",e),Le(n,"SID","null"),s.Z=!0,me(s,n,null)):me(s,n,e),this.G=2}}else 3==this.G&&(t?Mn(this,t):0==this.i.length||Ye(this.h)||Mn(this))},r.Ia=function(){if(this.u=null,qn(this),this.$&&!(this.K||null==this.g||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=Zt(w(this.eb,this),t)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Jt(10),On(this),qn(this))},r.cb=function(){null!=this.v&&(this.v=null,On(this),Fn(this),Jt(19))},r.kb=function(t){t?(this.j.info("Successfully pinged google.com"),Jt(2)):(this.j.info("Failed to ping google.com"),Jt(1))},(r=Qn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},Xn.prototype.g=function(t,e){return new Jn(t,e)},T(Jn,Tt),Jn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;Jt(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=Gn(t,null,t.V),Pn(t)},Jn.prototype.close=function(){Rn(this.g)},Jn.prototype.u=function(t){var e=this.g;if("string"===typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=_t(t),t=n);e.i.push(new class{constructor(t,e){this.h=t,this.g=e}}(e.ab++,t)),3==e.G&&Pn(e)},Jn.prototype.M=function(){this.g.l=null,delete this.j,Rn(this.g),delete this.g,Jn.X.M.call(this)},T(Yn,ae),T(Zn,ce),T(tr,Qn),tr.prototype.xa=function(){bt(this.g,"a")},tr.prototype.wa=function(t){bt(this.g,new Yn(t))},tr.prototype.va=function(t){bt(this.g,new Zn)},tr.prototype.ua=function(){bt(this.g,"b")},Xn.prototype.createWebChannel=Xn.prototype.g,Jn.prototype.send=Jn.prototype.u,Jn.prototype.open=Jn.prototype.m,Jn.prototype.close=Jn.prototype.close,te.NO_ERROR=0,te.TIMEOUT=8,te.HTTP_ERROR=6,ee.COMPLETE="complete",se.EventType=oe,oe.OPEN="a",oe.CLOSE="b",oe.ERROR="c",oe.MESSAGE="d",Tt.prototype.listen=Tt.prototype.N,gn.prototype.listenOnce=gn.prototype.O,gn.prototype.getLastError=gn.prototype.Oa,gn.prototype.getLastErrorCode=gn.prototype.Ea,gn.prototype.getStatus=gn.prototype.aa,gn.prototype.getResponseJson=gn.prototype.Sa,gn.prototype.getResponseText=gn.prototype.fa,gn.prototype.send=gn.prototype.da,gn.prototype.setWithCredentials=gn.prototype.Ka;var er=u.createWebChannelTransport=function(){return new Xn},nr=u.getStatEventTarget=function(){return Gt()},rr=u.ErrorCode=te,sr=u.EventType=ee,ir=u.Event=Kt,or=u.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},ar=u.FetchXmlHttpFactory=un,cr=u.WebChannel=se,ur=u.XhrIo=gn;n(3454);const hr="@firebase/firestore";class lr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}lr.UNAUTHENTICATED=new lr(null),lr.GOOGLE_CREDENTIALS=new lr("google-credentials-uid"),lr.FIRST_PARTY=new lr("first-party-uid"),lr.MOCK_USER=new lr("mock-user");let dr="9.13.0";const fr=new o.Yd("@firebase/firestore");function pr(){return fr.logLevel}function mr(t,...e){if(fr.logLevel<=o.in.DEBUG){const n=e.map(vr);fr.debug(`Firestore (${dr}): ${t}`,...n)}}function gr(t,...e){if(fr.logLevel<=o.in.ERROR){const n=e.map(vr);fr.error(`Firestore (${dr}): ${t}`,...n)}}function yr(t,...e){if(fr.logLevel<=o.in.WARN){const n=e.map(vr);fr.warn(`Firestore (${dr}): ${t}`,...n)}}function vr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function wr(t="Unexpected state"){const e=`FIRESTORE (${dr}) INTERNAL ASSERTION FAILED: `+t;throw gr(e),new Error(e)}function Ir(t,e){t||wr()}function Tr(t,e){return t}const br={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Er extends a.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class _r{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Sr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class kr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(lr.UNAUTHENTICATED)))}shutdown(){}}class Cr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ar{constructor(t){this.t=t,this.currentUser=lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new _r;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new _r,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{mr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(mr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new _r)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(mr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ir("string"==typeof e.accessToken),new Sr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Ir(null===t||"string"==typeof t),new lr(t)}}class Nr{constructor(t,e,n,r){this.h=t,this.l=e,this.m=n,this.g=r,this.type="FirstParty",this.user=lr.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Ir(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Dr{constructor(t,e,n,r){this.h=t,this.l=e,this.m=n,this.g=r}getToken(){return Promise.resolve(new Nr(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable((()=>e(lr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Rr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Or{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const n=t=>{null!=t.error&&mr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.A;return this.A=t.token,mr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{mr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.T.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.T.getImmediate({optional:!0});t?r(t):mr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Ir("string"==typeof t.token),this.A=t.token,new Rr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Lr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class Pr{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Lr(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function Mr(t,e){return t<e?-1:t>e?1:0}function xr(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Ur{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Er(br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Er(br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Er(br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Er(br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ur.fromMillis(Date.now())}static fromDate(t){return Ur.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Ur(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Mr(this.nanoseconds,t.nanoseconds):Mr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Vr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Vr(t)}static min(){return new Vr(new Ur(0,0))}static max(){return new Vr(new Ur(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Fr{constructor(t,e,n){void 0===e?e=0:e>t.length&&wr(),void 0===n?n=t.length-e:n>t.length-e&&wr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Fr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Fr?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class jr extends Fr{construct(t,e,n){return new jr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Er(br.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new jr(e)}static emptyPath(){return new jr([])}}const qr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Br extends Fr{construct(t,e,n){return new Br(t,e,n)}static isValidIdentifier(t){return qr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Br.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Br(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Er(br.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Er(br.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Er(br.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Er(br.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Br(e)}static emptyPath(){return new Br([])}}class zr{constructor(t){this.path=t}static fromPath(t){return new zr(jr.fromString(t))}static fromName(t){return new zr(jr.fromString(t).popFirst(5))}static empty(){return new zr(jr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===jr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return jr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new zr(new jr(t.slice()))}}class $r{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}$r.UNKNOWN_ID=-1;function Kr(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=Vr.fromTimestamp(1e9===r?new Ur(n+1,0):new Ur(n,r));return new Gr(s,zr.empty(),e)}function Hr(t){return new Gr(t.readTime,t.key,-1)}class Gr{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Gr(Vr.min(),zr.empty(),-1)}static max(){return new Gr(Vr.max(),zr.empty(),-1)}}function Wr(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=zr.comparator(t.documentKey,e.documentKey),0!==n?n:Mr(t.largestBatchId,e.largestBatchId))}const Qr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Xr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Jr(t){if(t.code!==br.FAILED_PRECONDITION||t.message!==Qr)throw t;mr("LocalStore","Unexpectedly lost primary lease")}class Yr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&wr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Yr(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Yr?e:Yr.resolve(e)}catch(t){return Yr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Yr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Yr.reject(e)}static resolve(t){return new Yr(((e,n)=>{e(t)}))}static reject(t){return new Yr(((e,n)=>{n(t)}))}static waitFor(t){return new Yr(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Yr.resolve(!1);for(const n of t)e=e.next((t=>t?Yr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Yr(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new Yr(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}function Zr(t){return"IndexedDbTransactionError"===t.name}class ts{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ut(t),this.ct=t=>e.writeSequenceNumber(t))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}function es(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ns(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function rs(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}ts.at=-1;class ss{constructor(t,e){this.comparator=t,this.root=e||os.EMPTY}insert(t,e){return new ss(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,os.BLACK,null,null))}remove(t){return new ss(this.comparator,this.root.remove(t,this.comparator).copy(null,null,os.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new is(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new is(this.root,t,this.comparator,!1)}getReverseIterator(){return new is(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new is(this.root,t,this.comparator,!0)}}class is{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class os{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:os.RED,this.left=null!=r?r:os.EMPTY,this.right=null!=s?s:os.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new os(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return os.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return os.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,os.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,os.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw wr();if(this.right.isRed())throw wr();const t=this.left.check();if(t!==this.right.check())throw wr();return t+(this.isRed()?0:1)}}os.EMPTY=null,os.RED=!0,os.BLACK=!1,os.EMPTY=new class{constructor(){this.size=0}get key(){throw wr()}get value(){throw wr()}get color(){throw wr()}get left(){throw wr()}get right(){throw wr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new os(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class as{constructor(t){this.comparator=t,this.data=new ss(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new cs(this.data.getIterator())}getIteratorFrom(t){return new cs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof as))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new as(this.comparator);return e.data=t,e}}class cs{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class us{constructor(t){this.fields=t,t.sort(Br.comparator)}static empty(){return new us([])}unionWith(t){let e=new as(Br.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new us(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return xr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class hs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new hs(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new hs(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Mr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}hs.EMPTY_BYTE_STRING=new hs("");const ls=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ds(t){if(Ir(!!t),"string"==typeof t){let e=0;const n=ls.exec(t);if(Ir(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:fs(t.seconds),nanos:fs(t.nanos)}}function fs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ps(t){return"string"==typeof t?hs.fromBase64String(t):hs.fromUint8Array(t)}function ms(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function gs(t){const e=t.mapValue.fields.__previous_value__;return ms(e)?gs(e):e}function ys(t){const e=ds(t.mapValue.fields.__local_write_time__.timestampValue);return new Ur(e.seconds,e.nanos)}class vs{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class ws{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new ws("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof ws&&t.projectId===this.projectId&&t.database===this.database}}function Is(t){return null==t}function Ts(t){return 0===t&&1/t==-1/0}function bs(t){return"number"==typeof t&&Number.isInteger(t)&&!Ts(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const Es={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function _s(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ms(t)?4:Vs(t)?9007199254740991:10:wr()}function Ss(t,e){if(t===e)return!0;const n=_s(t);if(n!==_s(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ys(t).isEqual(ys(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ds(t.timestampValue),r=ds(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ps(t.bytesValue).isEqual(ps(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return fs(t.geoPointValue.latitude)===fs(e.geoPointValue.latitude)&&fs(t.geoPointValue.longitude)===fs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return fs(t.integerValue)===fs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=fs(t.doubleValue),r=fs(e.doubleValue);return n===r?Ts(n)===Ts(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return xr(t.arrayValue.values||[],e.arrayValue.values||[],Ss);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(es(n)!==es(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!Ss(n[s],r[s])))return!1;return!0}(t,e);default:return wr()}}function ks(t,e){return void 0!==(t.values||[]).find((t=>Ss(t,e)))}function Cs(t,e){if(t===e)return 0;const n=_s(t),r=_s(e);if(n!==r)return Mr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Mr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=fs(t.integerValue||t.doubleValue),r=fs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return As(t.timestampValue,e.timestampValue);case 4:return As(ys(t),ys(e));case 5:return Mr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ps(t),r=ps(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=Mr(n[s],r[s]);if(0!==t)return t}return Mr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Mr(fs(t.latitude),fs(e.latitude));return 0!==n?n:Mr(fs(t.longitude),fs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=Cs(n[s],r[s]);if(t)return t}return Mr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Es.mapValue&&e===Es.mapValue)return 0;if(t===Es.mapValue)return 1;if(e===Es.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=Mr(r[o],i[o]);if(0!==t)return t;const e=Cs(n[r[o]],s[i[o]]);if(0!==e)return e}return Mr(r.length,i.length)}(t.mapValue,e.mapValue);default:throw wr()}}function As(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Mr(t,e);const n=ds(t),r=ds(e),s=Mr(n.seconds,r.seconds);return 0!==s?s:Mr(n.nanos,r.nanos)}function Ns(t){return Ds(t)}function Ds(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=ds(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ps(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,zr.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Ds(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${Ds(t.fields[s])}`;return n+"}"}(t.mapValue):wr();var e,n}function Rs(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Os(t){return!!t&&"integerValue"in t}function Ls(t){return!!t&&"arrayValue"in t}function Ps(t){return!!t&&"nullValue"in t}function Ms(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function xs(t){return!!t&&"mapValue"in t}function Us(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ns(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Us(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Us(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Vs(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Fs{constructor(t){this.value=t}static empty(){return new Fs({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!xs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Us(e)}setAll(t){let e=Br.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Us(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());xs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ss(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];xs(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ns(e,((e,n)=>t[e]=n));for(const r of n)delete t[r]}clone(){return new Fs(Us(this.value))}}function js(t){const e=[];return ns(t.fields,((t,n)=>{const r=new Br([t]);if(xs(n)){const t=js(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new us(e)}class qs{constructor(t,e,n,r,s,i){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.data=s,this.documentState=i}static newInvalidDocument(t){return new qs(t,0,Vr.min(),Vr.min(),Fs.empty(),0)}static newFoundDocument(t,e,n){return new qs(t,1,e,Vr.min(),n,0)}static newNoDocument(t,e){return new qs(t,2,e,Vr.min(),Fs.empty(),0)}static newUnknownDocument(t,e){return new qs(t,3,e,Vr.min(),Fs.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Fs.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Fs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Vr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof qs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new qs(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bs{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ht=null}}function zs(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Bs(t,e,n,r,s,i,o)}function $s(t){const e=Tr(t);if(null===e.ht){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+Ns(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Is(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Ns(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Ns(t))).join(",")),e.ht=t}return e.ht}function Ks(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!si(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!Ss(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!oi(t.startAt,e.startAt)&&oi(t.endAt,e.endAt)}function Hs(t){return zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Gs extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.lt(t,e,n):new Ws(t,e,n):"array-contains"===e?new Ys(t,n):"in"===e?new Zs(t,n):"not-in"===e?new ti(t,n):"array-contains-any"===e?new ei(t,n):new Gs(t,e,n)}static lt(t,e,n){return"in"===e?new Qs(t,n):new Xs(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.ft(Cs(e,this.value)):null!==e&&_s(this.value)===_s(e)&&this.ft(Cs(e,this.value))}ft(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return wr()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ws extends Gs{constructor(t,e,n){super(t,e,n),this.key=zr.fromName(n.referenceValue)}matches(t){const e=zr.comparator(t.key,this.key);return this.ft(e)}}class Qs extends Gs{constructor(t,e){super(t,"in",e),this.keys=Js("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Xs extends Gs{constructor(t,e){super(t,"not-in",e),this.keys=Js("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Js(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>zr.fromName(t.referenceValue)))}class Ys extends Gs{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ls(e)&&ks(e.arrayValue,this.value)}}class Zs extends Gs{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ks(this.value.arrayValue,e)}}class ti extends Gs{constructor(t,e){super(t,"not-in",e)}matches(t){if(ks(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ks(this.value.arrayValue,e)}}class ei extends Gs{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ls(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ks(this.value.arrayValue,t)))}}class ni{constructor(t,e){this.position=t,this.inclusive=e}}class ri{constructor(t,e="asc"){this.field=t,this.dir=e}}function si(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ii(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?zr.comparator(zr.fromName(o.referenceValue),n.key):Cs(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function oi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ss(t.position[n],e.position[n]))return!1;return!0}class ai{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this._t=null,this.wt=null,this.startAt,this.endAt}}function ci(t,e,n,r,s,i,o,a){return new ai(t,e,n,r,s,i,o,a)}function ui(t){return new ai(t)}function hi(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function li(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function di(t){for(const e of t.filters)if(e.dt())return e.field;return null}function fi(t){return null!==t.collectionGroup}function pi(t){const e=Tr(t);if(null===e._t){e._t=[];const t=di(e),n=li(e);if(null!==t&&null===n)t.isKeyField()||e._t.push(new ri(t)),e._t.push(new ri(Br.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e._t.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new ri(Br.keyField(),t))}}}return e._t}function mi(t){const e=Tr(t);if(!e.wt)if("F"===e.limitType)e.wt=zs(e.path,e.collectionGroup,pi(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of pi(e)){const e="desc"===s.dir?"asc":"desc";t.push(new ri(s.field,e))}const n=e.endAt?new ni(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ni(e.startAt.position,e.startAt.inclusive):null;e.wt=zs(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.wt}function gi(t,e,n){return new ai(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function yi(t,e){return Ks(mi(t),mi(e))&&t.limitType===e.limitType}function vi(t){return`${$s(mi(t))}|lt:${t.limitType}`}function wi(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Ns(e.value)}`;var e})).join(", ")}]`),Is(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Ns(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Ns(t))).join(",")),`Target(${e})`}(mi(t))}; limitType=${t.limitType})`}function Ii(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):zr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=ii(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,pi(t),e))&&!(t.endAt&&!function(t,e,n){const r=ii(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,pi(t),e))}(t,e)}function Ti(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function bi(t){return(e,n)=>{let r=!1;for(const s of pi(t)){const t=Ei(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function Ei(t,e,n){const r=t.field.isKeyField()?zr.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?Cs(r,s):wr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return wr()}}function _i(t,e){if(t.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ts(e)?"-0":e}}function Si(t){return{integerValue:""+t}}function ki(t,e){return bs(e)?Si(e):_i(t,e)}class Ci{constructor(){this._=void 0}}function Ai(t,e,n){return t instanceof Ri?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Oi?Li(t,e):t instanceof Pi?Mi(t,e):function(t,e){const n=Di(t,e),r=Ui(n)+Ui(t.yt);return Os(n)&&Os(t.yt)?Si(r):_i(t.It,r)}(t,e)}function Ni(t,e,n){return t instanceof Oi?Li(t,e):t instanceof Pi?Mi(t,e):n}function Di(t,e){return t instanceof xi?Os(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ri extends Ci{}class Oi extends Ci{constructor(t){super(),this.elements=t}}function Li(t,e){const n=Vi(e);for(const r of t.elements)n.some((t=>Ss(t,r)))||n.push(r);return{arrayValue:{values:n}}}class Pi extends Ci{constructor(t){super(),this.elements=t}}function Mi(t,e){let n=Vi(e);for(const r of t.elements)n=n.filter((t=>!Ss(t,r)));return{arrayValue:{values:n}}}class xi extends Ci{constructor(t,e){super(),this.It=t,this.yt=e}}function Ui(t){return fs(t.integerValue||t.doubleValue)}function Vi(t){return Ls(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Fi{constructor(t,e){this.field=t,this.transform=e}}class ji{constructor(t,e){this.version=t,this.transformResults=e}}class qi{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new qi}static exists(t){return new qi(void 0,t)}static updateTime(t){return new qi(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Bi(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class zi{}function $i(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new to(t.key,qi.none()):new Qi(t.key,t.data,qi.none());{const n=t.data,r=Fs.empty();let s=new as(Br.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new Xi(t.key,r,new us(s.toArray()),qi.none())}}function Ki(t,e,n){t instanceof Qi?function(t,e,n){const r=t.value.clone(),s=Yi(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Xi?function(t,e,n){if(!Bi(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Yi(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Ji(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Hi(t,e,n,r){return t instanceof Qi?function(t,e,n,r){if(!Bi(t.precondition,e))return n;const s=t.value.clone(),i=Zi(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof Xi?function(t,e,n,r){if(!Bi(t.precondition,e))return n;const s=Zi(t.fieldTransforms,r,e),i=e.data;return i.setAll(Ji(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Bi(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Gi(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Di(r.transform,t||null);null!=s&&(null===n&&(n=Fs.empty()),n.set(r.field,s))}return n||null}function Wi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&xr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Oi&&e instanceof Oi||t instanceof Pi&&e instanceof Pi?xr(t.elements,e.elements,Ss):t instanceof xi&&e instanceof xi?Ss(t.yt,e.yt):t instanceof Ri&&e instanceof Ri}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Qi extends zi{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Xi extends zi{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ji(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Yi(t,e,n){const r=new Map;Ir(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Ni(o,a,n[s]))}return r}function Zi(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Ai(t,i,e))}return r}class to extends zi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class eo extends zi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class no{constructor(t){this.count=t}}var ro,so;function io(t){switch(t){default:return wr();case br.CANCELLED:case br.UNKNOWN:case br.DEADLINE_EXCEEDED:case br.RESOURCE_EXHAUSTED:case br.INTERNAL:case br.UNAVAILABLE:case br.UNAUTHENTICATED:return!1;case br.INVALID_ARGUMENT:case br.NOT_FOUND:case br.ALREADY_EXISTS:case br.PERMISSION_DENIED:case br.FAILED_PRECONDITION:case br.ABORTED:case br.OUT_OF_RANGE:case br.UNIMPLEMENTED:case br.DATA_LOSS:return!0}}function oo(t){if(void 0===t)return gr("GRPC error has no .code"),br.UNKNOWN;switch(t){case ro.OK:return br.OK;case ro.CANCELLED:return br.CANCELLED;case ro.UNKNOWN:return br.UNKNOWN;case ro.DEADLINE_EXCEEDED:return br.DEADLINE_EXCEEDED;case ro.RESOURCE_EXHAUSTED:return br.RESOURCE_EXHAUSTED;case ro.INTERNAL:return br.INTERNAL;case ro.UNAVAILABLE:return br.UNAVAILABLE;case ro.UNAUTHENTICATED:return br.UNAUTHENTICATED;case ro.INVALID_ARGUMENT:return br.INVALID_ARGUMENT;case ro.NOT_FOUND:return br.NOT_FOUND;case ro.ALREADY_EXISTS:return br.ALREADY_EXISTS;case ro.PERMISSION_DENIED:return br.PERMISSION_DENIED;case ro.FAILED_PRECONDITION:return br.FAILED_PRECONDITION;case ro.ABORTED:return br.ABORTED;case ro.OUT_OF_RANGE:return br.OUT_OF_RANGE;case ro.UNIMPLEMENTED:return br.UNIMPLEMENTED;case ro.DATA_LOSS:return br.DATA_LOSS;default:return wr()}}(so=ro||(ro={}))[so.OK=0]="OK",so[so.CANCELLED=1]="CANCELLED",so[so.UNKNOWN=2]="UNKNOWN",so[so.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",so[so.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",so[so.NOT_FOUND=5]="NOT_FOUND",so[so.ALREADY_EXISTS=6]="ALREADY_EXISTS",so[so.PERMISSION_DENIED=7]="PERMISSION_DENIED",so[so.UNAUTHENTICATED=16]="UNAUTHENTICATED",so[so.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",so[so.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",so[so.ABORTED=10]="ABORTED",so[so.OUT_OF_RANGE=11]="OUT_OF_RANGE",so[so.UNIMPLEMENTED=12]="UNIMPLEMENTED",so[so.INTERNAL=13]="INTERNAL",so[so.UNAVAILABLE=14]="UNAVAILABLE",so[so.DATA_LOSS=15]="DATA_LOSS";class ao{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){ns(this.inner,((e,n)=>{for(const[r,s]of n)t(r,s)}))}isEmpty(){return rs(this.inner)}size(){return this.innerSize}}const co=new ss(zr.comparator);function uo(){return co}const ho=new ss(zr.comparator);function lo(...t){let e=ho;for(const n of t)e=e.insert(n.key,n);return e}function fo(t){let e=ho;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function po(){return go()}function mo(){return go()}function go(){return new ao((t=>t.toString()),((t,e)=>t.isEqual(e)))}const yo=new ss(zr.comparator),vo=new as(zr.comparator);function wo(...t){let e=vo;for(const n of t)e=e.add(n);return e}const Io=new as(Mr);function To(){return Io}class bo{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Eo.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new bo(Vr.min(),r,To(),uo(),wo())}}class Eo{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Eo(n,e,wo(),wo(),wo())}}class _o{constructor(t,e,n,r){this.Tt=t,this.removedTargetIds=e,this.key=n,this.Et=r}}class So{constructor(t,e){this.targetId=t,this.At=e}}class ko{constructor(t,e,n=hs.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Co{constructor(){this.Rt=0,this.bt=Do(),this.Pt=hs.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(t){t.approximateByteSize()>0&&(this.Vt=!0,this.Pt=t)}xt(){let t=wo(),e=wo(),n=wo();return this.bt.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:wr()}})),new Eo(this.Pt,this.vt,t,e,n)}Nt(){this.Vt=!1,this.bt=Do()}kt(t,e){this.Vt=!0,this.bt=this.bt.insert(t,e)}Ot(t){this.Vt=!0,this.bt=this.bt.remove(t)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class Ao{constructor(t){this.Bt=t,this.Lt=new Map,this.Ut=uo(),this.qt=No(),this.Kt=new as(Mr)}Gt(t){for(const e of t.Tt)t.Et&&t.Et.isFoundDocument()?this.Qt(e,t.Et):this.jt(e,t.key,t.Et);for(const e of t.removedTargetIds)this.jt(e,t.key,t.Et)}Wt(t){this.forEachTarget(t,(e=>{const n=this.zt(e);switch(t.state){case 0:this.Ht(e)&&n.Ct(t.resumeToken);break;case 1:n.Ft(),n.St||n.Nt(),n.Ct(t.resumeToken);break;case 2:n.Ft(),n.St||this.removeTarget(e);break;case 3:this.Ht(e)&&(n.$t(),n.Ct(t.resumeToken));break;case 4:this.Ht(e)&&(this.Jt(e),n.Ct(t.resumeToken));break;default:wr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Lt.forEach(((t,n)=>{this.Ht(n)&&e(n)}))}Yt(t){const e=t.targetId,n=t.At.count,r=this.Xt(e);if(r){const t=r.target;if(Hs(t))if(0===n){const n=new zr(t.path);this.jt(e,n,qs.newNoDocument(n,Vr.min()))}else Ir(1===n);else this.Zt(e)!==n&&(this.Jt(e),this.Kt=this.Kt.add(e))}}te(t){const e=new Map;this.Lt.forEach(((n,r)=>{const s=this.Xt(r);if(s){if(n.current&&Hs(s.target)){const e=new zr(s.target.path);null!==this.Ut.get(e)||this.ee(r,e)||this.jt(r,e,qs.newNoDocument(e,t))}n.Dt&&(e.set(r,n.xt()),n.Nt())}}));let n=wo();this.qt.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Xt(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.Ut.forEach(((e,n)=>n.setReadTime(t)));const r=new bo(t,e,this.Kt,this.Ut,n);return this.Ut=uo(),this.qt=No(),this.Kt=new as(Mr),r}Qt(t,e){if(!this.Ht(t))return;const n=this.ee(t,e.key)?2:0;this.zt(t).kt(e.key,n),this.Ut=this.Ut.insert(e.key,e),this.qt=this.qt.insert(e.key,this.ne(e.key).add(t))}jt(t,e,n){if(!this.Ht(t))return;const r=this.zt(t);this.ee(t,e)?r.kt(e,1):r.Ot(e),this.qt=this.qt.insert(e,this.ne(e).delete(t)),n&&(this.Ut=this.Ut.insert(e,n))}removeTarget(t){this.Lt.delete(t)}Zt(t){const e=this.zt(t).xt();return this.Bt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Mt(t){this.zt(t).Mt()}zt(t){let e=this.Lt.get(t);return e||(e=new Co,this.Lt.set(t,e)),e}ne(t){let e=this.qt.get(t);return e||(e=new as(Mr),this.qt=this.qt.insert(t,e)),e}Ht(t){const e=null!==this.Xt(t);return e||mr("WatchChangeAggregator","Detected inactive target",t),e}Xt(t){const e=this.Lt.get(t);return e&&e.St?null:this.Bt.se(t)}Jt(t){this.Lt.set(t,new Co),this.Bt.getRemoteKeysForTarget(t).forEach((e=>{this.jt(t,e,null)}))}ee(t,e){return this.Bt.getRemoteKeysForTarget(t).has(e)}}function No(){return new ss(zr.comparator)}function Do(){return new ss(zr.comparator)}const Ro={asc:"ASCENDING",desc:"DESCENDING"},Oo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Lo{constructor(t,e){this.databaseId=t,this.gt=e}}function Po(t,e){return t.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mo(t,e){return t.gt?e.toBase64():e.toUint8Array()}function xo(t,e){return Po(t,e.toTimestamp())}function Uo(t){return Ir(!!t),Vr.fromTimestamp(function(t){const e=ds(t);return new Ur(e.seconds,e.nanos)}(t))}function Vo(t,e){return function(t){return new jr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Fo(t){const e=jr.fromString(t);return Ir(ia(e)),e}function jo(t,e){return Vo(t.databaseId,e.path)}function qo(t,e){const n=Fo(e);if(n.get(1)!==t.databaseId.projectId)throw new Er(br.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Er(br.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new zr(Ko(n))}function Bo(t,e){return Vo(t.databaseId,e)}function zo(t){const e=Fo(t);return 4===e.length?jr.emptyPath():Ko(e)}function $o(t){return new jr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ko(t){return Ir(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ho(t,e,n){return{name:jo(t,e),fields:n.value.mapValue.fields}}function Go(t,e){let n;if(e instanceof Qi)n={update:Ho(t,e.key,e.value)};else if(e instanceof to)n={delete:jo(t,e.key)};else if(e instanceof Xi)n={update:Ho(t,e.key,e.data),updateMask:sa(e.fieldMask)};else{if(!(e instanceof eo))return wr();n={verify:jo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ri)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Oi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Pi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xi)return{fieldPath:e.field.canonicalString(),increment:n.yt};throw wr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:xo(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:wr()}(t,e.precondition)),n}function Wo(t,e){return{documents:[Bo(t,e.path)]}}function Qo(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Bo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Bo(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Ms(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NAN"}};if(Ps(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ms(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NOT_NAN"}};if(Ps(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ta(t.field),op:Zo(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ta(t.field),direction:Yo(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.gt||Is(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Xo(t){let e=zo(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ir(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=Jo(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ri(ea(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Is(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ni(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new ni(n,e)}(n.endAt)),ci(e,s,o,i,a,"F",c,u)}function Jo(t){return t?void 0!==t.unaryFilter?[ra(t)]:void 0!==t.fieldFilter?[na(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Jo(t))).reduce(((t,e)=>t.concat(e))):wr():[]}function Yo(t){return Ro[t]}function Zo(t){return Oo[t]}function ta(t){return{fieldPath:t.canonicalString()}}function ea(t){return Br.fromServerFormat(t.fieldPath)}function na(t){return Gs.create(ea(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return wr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ra(t){switch(t.unaryFilter.op){case"IS_NAN":const e=ea(t.unaryFilter.field);return Gs.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=ea(t.unaryFilter.field);return Gs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ea(t.unaryFilter.field);return Gs.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ea(t.unaryFilter.field);return Gs.create(s,"!=",{nullValue:"NULL_VALUE"});default:return wr()}}function sa(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ia(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}const oa=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],aa=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ca=aa;class ua{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Ki(e,t,n[r])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Hi(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Hi(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=mo();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=$i(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Vr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),wo())}isEqual(t){return this.batchId===t.batchId&&xr(this.mutations,t.mutations,((t,e)=>Wi(t,e)))&&xr(this.baseMutations,t.baseMutations,((t,e)=>Wi(t,e)))}}class ha{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Ir(t.mutations.length===n.length);let r=yo;const s=t.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new ha(t,e,n,r)}}class la{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class da{constructor(t,e,n,r,s=Vr.min(),i=Vr.min(),o=hs.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new da(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new da(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class fa{constructor(t){this.re=t}}function pa(t){const e=Xo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?gi(e,e.limit,"L"):e}class ma{constructor(){}ce(t,e){this.ae(t,e),e.he()}ae(t,e){if("nullValue"in t)this.le(e,5);else if("booleanValue"in t)this.le(e,10),e.fe(t.booleanValue?1:0);else if("integerValue"in t)this.le(e,15),e.fe(fs(t.integerValue));else if("doubleValue"in t){const n=fs(t.doubleValue);isNaN(n)?this.le(e,13):(this.le(e,15),Ts(n)?e.fe(0):e.fe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.le(e,20),"string"==typeof n?e.de(n):(e.de(`${n.seconds||""}`),e.fe(n.nanos||0))}else if("stringValue"in t)this._e(t.stringValue,e),this.we(e);else if("bytesValue"in t)this.le(e,30),e.me(ps(t.bytesValue)),this.we(e);else if("referenceValue"in t)this.ge(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.le(e,45),e.fe(n.latitude||0),e.fe(n.longitude||0)}else"mapValue"in t?Vs(t)?this.le(e,Number.MAX_SAFE_INTEGER):(this.ye(t.mapValue,e),this.we(e)):"arrayValue"in t?(this.pe(t.arrayValue,e),this.we(e)):wr()}_e(t,e){this.le(e,25),this.Ie(t,e)}Ie(t,e){e.de(t)}ye(t,e){const n=t.fields||{};this.le(e,55);for(const r of Object.keys(n))this._e(r,e),this.ae(n[r],e)}pe(t,e){const n=t.values||[];this.le(e,50);for(const r of n)this.ae(r,e)}ge(t,e){this.le(e,37),zr.fromName(t).path.forEach((t=>{this.le(e,60),this.Ie(t,e)}))}le(t,e){t.fe(e)}we(t){t.fe(2)}}ma.Te=new ma;class ga{constructor(){this.Ye=new ya}addToCollectionParentIndex(t,e){return this.Ye.add(e),Yr.resolve()}getCollectionParents(t,e){return Yr.resolve(this.Ye.getEntries(e))}addFieldIndex(t,e){return Yr.resolve()}deleteFieldIndex(t,e){return Yr.resolve()}getDocumentsMatchingTarget(t,e){return Yr.resolve(null)}getIndexType(t,e){return Yr.resolve(0)}getFieldIndexes(t,e){return Yr.resolve([])}getNextCollectionGroupToUpdate(t){return Yr.resolve(null)}getMinOffset(t,e){return Yr.resolve(Gr.min())}getMinOffsetFromCollectionGroup(t,e){return Yr.resolve(Gr.min())}updateCollectionGroup(t,e,n){return Yr.resolve()}updateIndexEntries(t,e){return Yr.resolve()}}class ya{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new as(jr.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new as(jr.comparator)).toArray()}}new Uint8Array(0);class va{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new va(t,va.DEFAULT_COLLECTION_PERCENTILE,va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}va.DEFAULT_COLLECTION_PERCENTILE=10,va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,va.DEFAULT=new va(41943040,va.DEFAULT_COLLECTION_PERCENTILE,va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),va.DISABLED=new va(-1,0,0);class wa{constructor(t){this.bn=t}next(){return this.bn+=2,this.bn}static Pn(){return new wa(0)}static vn(){return new wa(-1)}}class Ia{constructor(){this.changes=new ao((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,qs.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Yr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ta{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class ba{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&Hi(n.mutation,t,us.empty(),Ur.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,wo()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=wo()){const r=po();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=lo();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=po();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,wo())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=uo();const i=go(),o=go();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Xi)?s=s.insert(e.key,e):void 0!==o&&(i.set(e.key,o.mutation.getFieldMask()),Hi(o.mutation,e,o.mutation.getFieldMask(),Ur.now()))})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Ta(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=go();let r=new ss(((t,e)=>t-e)),s=wo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||us.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||wo()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=mo();c.forEach((t=>{if(!s.has(t)){const r=$i(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Yr.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):fi(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):Yr.resolve(po());let o=-1,a=s;return i.next((e=>Yr.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Yr.resolve():this.getBaseDocument(t,e,n).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,wo()))).next((t=>({batchId:o,changes:fo(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new zr(e)).next((t=>{let e=lo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const r=e.collectionGroup;let s=lo();return this.indexManager.getCollectionParents(t,r).next((i=>Yr.forEach(i,(i=>{const o=function(t,e){return new ai(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let r;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===r.get(n)&&(r=r.insert(n,qs.newInvalidDocument(n)))}));let n=lo();return r.forEach(((r,s)=>{const i=t.get(r);void 0!==i&&Hi(i.mutation,s,us.empty(),Ur.now()),Ii(e,s)&&(n=n.insert(r,s))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):Yr.resolve(qs.newInvalidDocument(e))}}class Ea{constructor(t){this.It=t,this.Zn=new Map,this.ts=new Map}getBundleMetadata(t,e){return Yr.resolve(this.Zn.get(e))}saveBundleMetadata(t,e){var n;return this.Zn.set(e.id,{id:(n=e).id,version:n.version,createTime:Uo(n.createTime)}),Yr.resolve()}getNamedQuery(t,e){return Yr.resolve(this.ts.get(e))}saveNamedQuery(t,e){return this.ts.set(e.name,function(t){return{name:t.name,query:pa(t.bundledQuery),readTime:Uo(t.readTime)}}(e)),Yr.resolve()}}class _a{constructor(){this.overlays=new ss(zr.comparator),this.es=new Map}getOverlay(t,e){return Yr.resolve(this.overlays.get(e))}getOverlays(t,e){const n=po();return Yr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ue(t,e,r)})),Yr.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.es.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.es.delete(n)),Yr.resolve()}getOverlaysForCollection(t,e,n){const r=po(),s=e.length+1,i=new zr(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Yr.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new ss(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=po(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=po(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Yr.resolve(o)}ue(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new la(e,n));let s=this.es.get(e);void 0===s&&(s=wo(),this.es.set(e,s)),this.es.set(e,s.add(n.key))}}class Sa{constructor(){this.ns=new as(ka.ss),this.rs=new as(ka.os)}isEmpty(){return this.ns.isEmpty()}addReference(t,e){const n=new ka(t,e);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.cs(new ka(t,e))}hs(t,e){t.forEach((t=>this.removeReference(t,e)))}ls(t){const e=new zr(new jr([])),n=new ka(e,t),r=new ka(e,t+1),s=[];return this.rs.forEachInRange([n,r],(t=>{this.cs(t),s.push(t.key)})),s}fs(){this.ns.forEach((t=>this.cs(t)))}cs(t){this.ns=this.ns.delete(t),this.rs=this.rs.delete(t)}ds(t){const e=new zr(new jr([])),n=new ka(e,t),r=new ka(e,t+1);let s=wo();return this.rs.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new ka(t,0),n=this.ns.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ka{constructor(t,e){this.key=t,this._s=e}static ss(t,e){return zr.comparator(t.key,e.key)||Mr(t._s,e._s)}static os(t,e){return Mr(t._s,e._s)||zr.comparator(t.key,e.key)}}class Ca{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ws=1,this.gs=new as(ka.ss)}checkEmpty(t){return Yr.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new ua(s,e,n,r);this.mutationQueue.push(i);for(const o of r)this.gs=this.gs.add(new ka(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return Yr.resolve(i)}lookupMutationBatch(t,e){return Yr.resolve(this.ys(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ps(n),s=r<0?0:r;return Yr.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Yr.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(t){return Yr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ka(e,0),r=new ka(e,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([n,r],(t=>{const e=this.ys(t._s);s.push(e)})),Yr.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new as(Mr);return e.forEach((t=>{const e=new ka(t,0),r=new ka(t,Number.POSITIVE_INFINITY);this.gs.forEachInRange([e,r],(t=>{n=n.add(t._s)}))})),Yr.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;zr.isDocumentKey(s)||(s=s.child(""));const i=new ka(new zr(s),0);let o=new as(Mr);return this.gs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t._s)),!0)}),i),Yr.resolve(this.Is(o))}Is(t){const e=[];return t.forEach((t=>{const n=this.ys(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Ir(0===this.Ts(e.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return Yr.forEach(e.mutations,(r=>{const s=new ka(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.gs=n}))}An(t){}containsKey(t,e){const n=new ka(e,0),r=this.gs.firstAfterOrEqual(n);return Yr.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Yr.resolve()}Ts(t,e){return this.ps(t)}ps(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}ys(t){const e=this.ps(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Aa{constructor(t){this.Es=t,this.docs=new ss(zr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.Es(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Yr.resolve(n?n.document.mutableCopy():qs.newInvalidDocument(e))}getEntries(t,e){let n=uo();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():qs.newInvalidDocument(t))})),Yr.resolve(n)}getAllFromCollection(t,e,n){let r=uo();const s=new zr(e.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s}}=i.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||Wr(Hr(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return Yr.resolve(r)}getAllFromCollectionGroup(t,e,n,r){wr()}As(t,e){return Yr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Na(this)}getSize(t){return Yr.resolve(this.size)}}class Na extends Ia{constructor(t){super(),this.Yn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.Yn.addEntry(t,r)):this.Yn.removeEntry(n)})),Yr.waitFor(e)}getFromCache(t,e){return this.Yn.getEntry(t,e)}getAllFromCache(t,e){return this.Yn.getEntries(t,e)}}class Da{constructor(t){this.persistence=t,this.Rs=new ao((t=>$s(t)),Ks),this.lastRemoteSnapshotVersion=Vr.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Sa,this.targetCount=0,this.vs=wa.Pn()}forEachTarget(t,e){return this.Rs.forEach(((t,n)=>e(n))),Yr.resolve()}getLastRemoteSnapshotVersion(t){return Yr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Yr.resolve(this.bs)}allocateTargetId(t){return this.highestTargetId=this.vs.next(),Yr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.bs&&(this.bs=e),Yr.resolve()}Dn(t){this.Rs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.vs=new wa(e),this.highestTargetId=e),t.sequenceNumber>this.bs&&(this.bs=t.sequenceNumber)}addTargetData(t,e){return this.Dn(e),this.targetCount+=1,Yr.resolve()}updateTargetData(t,e){return this.Dn(e),Yr.resolve()}removeTargetData(t,e){return this.Rs.delete(e.target),this.Ps.ls(e.targetId),this.targetCount-=1,Yr.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Rs.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Rs.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Yr.waitFor(s).next((()=>r))}getTargetCount(t){return Yr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Rs.get(e)||null;return Yr.resolve(n)}addMatchingKeys(t,e,n){return this.Ps.us(e,n),Yr.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Yr.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Ps.ls(e),Yr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Ps.ds(e);return Yr.resolve(n)}containsKey(t,e){return Yr.resolve(this.Ps.containsKey(e))}}class Ra{constructor(t,e){this.Vs={},this.overlays={},this.Ss=new ts(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=t(this),this.Cs=new Da(this),this.indexManager=new ga,this.remoteDocumentCache=function(t){return new Aa(t)}((t=>this.referenceDelegate.xs(t))),this.It=new fa(e),this.Ns=new Ea(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new _a,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Vs[t.toKey()];return n||(n=new Ca(e,this.referenceDelegate),this.Vs[t.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(t,e,n){mr("MemoryPersistence","Starting transaction:",t);const r=new Oa(this.Ss.next());return this.referenceDelegate.ks(),n(r).next((t=>this.referenceDelegate.Os(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ms(t,e){return Yr.or(Object.values(this.Vs).map((n=>()=>n.containsKey(t,e))))}}class Oa extends Xr{constructor(t){super(),this.currentSequenceNumber=t}}class La{constructor(t){this.persistence=t,this.Fs=new Sa,this.$s=null}static Bs(t){return new La(t)}get Ls(){if(this.$s)return this.$s;throw wr()}addReference(t,e,n){return this.Fs.addReference(n,e),this.Ls.delete(n.toString()),Yr.resolve()}removeReference(t,e,n){return this.Fs.removeReference(n,e),this.Ls.add(n.toString()),Yr.resolve()}markPotentiallyOrphaned(t,e){return this.Ls.add(e.toString()),Yr.resolve()}removeTarget(t,e){this.Fs.ls(e.targetId).forEach((t=>this.Ls.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ls.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}ks(){this.$s=new Set}Os(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Yr.forEach(this.Ls,(n=>{const r=zr.fromPath(n);return this.Us(t,r).next((t=>{t||e.removeEntry(r,Vr.min())}))})).next((()=>(this.$s=null,e.apply(t))))}updateLimboDocument(t,e){return this.Us(t,e).next((t=>{t?this.Ls.delete(e.toString()):this.Ls.add(e.toString())}))}xs(t){return 0}Us(t,e){return Yr.or([()=>Yr.resolve(this.Fs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ms(t,e)])}}class Pa{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Si=n,this.Di=r}static Ci(t,e){let n=wo(),r=wo();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Pa(t,e.fromCache,n,r)}}class Ma{constructor(){this.xi=!1}initialize(t,e){this.Ni=t,this.indexManager=e,this.xi=!0}getDocumentsMatchingQuery(t,e,n,r){return this.ki(t,e).next((s=>s||this.Oi(t,e,r,n))).next((n=>n||this.Mi(t,e)))}ki(t,e){if(hi(e))return Yr.resolve(null);let n=mi(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=gi(e,null,"F"),n=mi(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=wo(...r);return this.Ni.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Fi(e,r);return this.$i(e,i,s,n.readTime)?this.ki(t,gi(e,null,"F")):this.Bi(t,i,e,n)}))))})))))}Oi(t,e,n,r){return hi(e)||r.isEqual(Vr.min())?this.Mi(t,e):this.Ni.getDocuments(t,n).next((s=>{const i=this.Fi(e,s);return this.$i(e,i,n,r)?this.Mi(t,e):(pr()<=o.in.DEBUG&&mr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),wi(e)),this.Bi(t,i,e,Kr(r,-1)))}))}Fi(t,e){let n=new as(bi(t));return e.forEach(((e,r)=>{Ii(t,r)&&(n=n.add(r))})),n}$i(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(t,e){return pr()<=o.in.DEBUG&&mr("QueryEngine","Using full collection scan to execute query:",wi(e)),this.Ni.getDocumentsMatchingQuery(t,e,Gr.min())}Bi(t,e,n,r){return this.Ni.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class xa{constructor(t,e,n,r){this.persistence=t,this.Li=e,this.It=r,this.Ui=new ss(Mr),this.qi=new ao((t=>$s(t)),Ks),this.Ki=new Map,this.Gi=t.getRemoteDocumentCache(),this.Cs=t.getTargetCache(),this.Ns=t.getBundleCache(),this.Qi(n)}Qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ba(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ui)))}}function Ua(t,e,n,r){return new xa(t,e,n,r)}async function Va(t,e){const n=Tr(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n.Qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=wo();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ji:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Fa(t){const e=Tr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Cs.getLastRemoteSnapshotVersion(t)))}function ja(t,e,n){let r=wo(),s=wo();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=uo();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Vr.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):mr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Wi:r,zi:s}}))}function qa(t,e){const n=Tr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function Ba(t,e){const n=Tr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Cs.getTargetData(t,e).next((s=>s?(r=s,Yr.resolve(r)):n.Cs.allocateTargetId(t).next((s=>(r=new da(e,s,0,t.currentSequenceNumber),n.Cs.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Ui.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(t.targetId,t),n.qi.set(e,t.targetId)),t}))}async function za(t,e,n){const r=Tr(t),s=r.Ui.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Zr(t))throw t;mr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ui=r.Ui.remove(e),r.qi.delete(s.target)}function $a(t,e,n){const r=Tr(t);let s=Vr.min(),i=wo();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=Tr(t),s=r.qi.get(n);return void 0!==s?Yr.resolve(r.Ui.get(s)):r.Cs.getTargetData(e,n)}(r,t,mi(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.Li.getDocumentsMatchingQuery(t,e,n?s:Vr.min(),n?i:wo()))).next((t=>(Ka(r,Ti(e),t),{documents:t,Hi:i})))))}function Ka(t,e,n){let r=t.Ki.get(e)||Vr.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Ki.set(e,r)}class Ha{constructor(){this.activeTargetIds=To()}er(t){this.activeTargetIds=this.activeTargetIds.add(t)}nr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}tr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ga{constructor(){this.Lr=new Ha,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Lr.er(t),this.Ur[t]||"not-current"}updateQueryState(t,e,n){this.Ur[t]=e}removeLocalQueryTarget(t){this.Lr.nr(t)}isLocalQueryTarget(t){return this.Lr.activeTargetIds.has(t)}clearQueryState(t){delete this.Ur[t]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(t){return this.Lr.activeTargetIds.has(t)}start(){return this.Lr=new Ha,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Wa{qr(t){}shutdown(){}}class Qa{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(t){this.Wr.push(t)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){mr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Wr)t(0)}jr(){mr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Wr)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Xa={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ja{constructor(t){this.Hr=t.Hr,this.Jr=t.Jr}Yr(t){this.Xr=t}Zr(t){this.eo=t}onMessage(t){this.no=t}close(){this.Jr()}send(t){this.Hr(t)}so(){this.Xr()}io(t){this.eo(t)}ro(t){this.no(t)}}class Ya extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.oo=e+"://"+t.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,n,r,s){const i=this.ho(t,e);mr("RestConnection","Sending: ",i,n);const o={};return this.lo(o,r,s),this.fo(t,i,o,n).then((t=>(mr("RestConnection","Received: ",t),t)),(e=>{throw yr("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}_o(t,e,n,r,s,i){return this.ao(t,e,n,r,s)}lo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+dr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}ho(t,e){const n=Xa[t];return`${this.oo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}fo(t,e,n,r){return new Promise(((s,i)=>{const o=new ur;o.setWithCredentials(!0),o.listenOnce(sr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case rr.NO_ERROR:const e=o.getResponseJson();mr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case rr.TIMEOUT:mr("Connection",'RPC "'+t+'" timed out'),i(new Er(br.DEADLINE_EXCEEDED,"Request time out"));break;case rr.HTTP_ERROR:const n=o.getStatus();if(mr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(br).indexOf(e)>=0?e:br.UNKNOWN}(t.status);i(new Er(e,t.message))}else i(new Er(br.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Er(br.UNAVAILABLE,"Connection failed."));break;default:wr()}}finally{mr("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}wo(t,e,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=er(),i=nr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new ar({})),this.lo(o.initMessageHeaders,e,n),o.encodeInitMessageHeaders=!0;const a=r.join("");mr("Connection","Creating WebChannel: "+a,o);const c=s.createWebChannel(a,o);let u=!1,h=!1;const l=new Ja({Hr:t=>{h?mr("Connection","Not sending because WebChannel is closed:",t):(u||(mr("Connection","Opening WebChannel transport."),c.open(),u=!0),mr("Connection","WebChannel sending:",t),c.send(t))},Jr:()=>c.close()}),d=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return d(c,cr.EventType.OPEN,(()=>{h||mr("Connection","WebChannel transport opened.")})),d(c,cr.EventType.CLOSE,(()=>{h||(h=!0,mr("Connection","WebChannel transport closed"),l.io())})),d(c,cr.EventType.ERROR,(t=>{h||(h=!0,yr("Connection","WebChannel transport errored:",t),l.io(new Er(br.UNAVAILABLE,"The operation could not be completed")))})),d(c,cr.EventType.MESSAGE,(t=>{var e;if(!h){const n=t.data[0];Ir(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){mr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=ro[t];if(void 0!==e)return oo(e)}(t),n=s.message;void 0===e&&(e=br.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),h=!0,l.io(new Er(e,n)),c.close()}else mr("Connection","WebChannel received:",n),l.ro(n)}})),d(i,ir.STAT_EVENT,(t=>{t.stat===or.PROXY?mr("Connection","Detected buffering proxy"):t.stat===or.NOPROXY&&mr("Connection","Detected no buffering proxy")})),setTimeout((()=>{l.so()}),0),l}}function Za(){return"undefined"!=typeof document?document:null}function tc(t){return new Lo(t,!0)}class ec{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Hs=t,this.timerId=e,this.mo=n,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(t){this.cancel();const e=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,e-n);r>0&&mr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),t()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class nc{constructor(t,e,n,r,s,i,o,a){this.Hs=t,this.vo=n,this.Vo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new ec(t,e)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(()=>this.$o())))}Bo(t){this.Lo(),this.stream.send(t)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(t,e){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==t?this.xo.reset():e&&e.code===br.RESOURCE_EXHAUSTED?(gr(e.toString()),gr("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):e&&e.code===br.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Zr(e)}qo(){}auth(){this.state=1;const t=this.Ko(this.So),e=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.So===e&&this.Go(t,n)}),(e=>{t((()=>{const t=new Er(br.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Qo(t)}))}))}Go(t,e){const n=this.Ko(this.So);this.stream=this.jo(t,e),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((t=>{n((()=>this.Qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Oo(){this.state=5,this.xo.Ro((async()=>{this.state=0,this.start()}))}Qo(t){return mr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Ko(t){return e=>{this.Hs.enqueueAndForget((()=>this.So===t?e():(mr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class rc extends nc{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.It=s}jo(t,e){return this.connection.wo("Listen",t,e)}onMessage(t){this.xo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:wr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.gt?(Ir(void 0===e||"string"==typeof e),hs.fromBase64String(e||"")):(Ir(void 0===e||e instanceof Uint8Array),hs.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?br.UNKNOWN:oo(t.code);return new Er(e,t.message||"")}(o);n=new ko(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=qo(t,r.document.name),i=Uo(r.document.updateTime),o=new Fs({mapValue:{fields:r.document.fields}}),a=qs.newFoundDocument(s,i,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new _o(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=qo(t,r.document),i=r.readTime?Uo(r.readTime):Vr.min(),o=qs.newNoDocument(s,i),a=r.removedTargetIds||[];n=new _o([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=qo(t,r.document),i=r.removedTargetIds||[];n=new _o([],i,s,null)}else{if(!("filter"in e))return wr();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,s=new no(r),i=t.targetId;n=new So(i,s)}}return n}(this.It,t),n=function(t){if(!("targetChange"in t))return Vr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Vr.min():e.readTime?Uo(e.readTime):Vr.min()}(t);return this.listener.Wo(e,n)}zo(t){const e={};e.database=$o(this.It),e.addTarget=function(t,e){let n;const r=e.target;return n=Hs(r)?{documents:Wo(t,r)}:{query:Qo(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Mo(t,e.resumeToken):e.snapshotVersion.compareTo(Vr.min())>0&&(n.readTime=Po(t,e.snapshotVersion.toTimestamp())),n}(this.It,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return wr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.It,t);n&&(e.labels=n),this.Bo(e)}Ho(t){const e={};e.database=$o(this.It),e.removeTarget=t,this.Bo(e)}}class sc extends nc{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.It=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(t,e){return this.connection.wo("Write",t,e)}onMessage(t){if(Ir(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Jo){this.xo.reset();const e=function(t,e){return t&&t.length>0?(Ir(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Uo(t.updateTime):Uo(e);return n.isEqual(Vr.min())&&(n=Uo(e)),new ji(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Uo(t.commitTime);return this.listener.Zo(n,e)}return Ir(!t.writeResults||0===t.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const t={};t.database=$o(this.It),this.Bo(t)}Xo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Go(this.It,t)))};this.Bo(e)}}class ic extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.It=r,this.nu=!1}su(){if(this.nu)throw new Er(br.FAILED_PRECONDITION,"The client has already been terminated.")}ao(t,e,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.ao(t,e,n,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===br.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Er(br.UNKNOWN,t.toString())}))}_o(t,e,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection._o(t,e,n,s,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===br.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Er(br.UNKNOWN,t.toString())}))}terminate(){this.nu=!0}}class oc{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(t){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.cu("Offline")))}set(t){this.lu(),this.iu=0,"Online"===t&&(this.ou=!1),this.cu(t)}cu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}au(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(gr(e),this.ou=!1):mr("OnlineStateTracker",e)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class ac{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.qr((t=>{n.enqueueAndForget((async()=>{gc(this)&&(mr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Tr(t);e._u.add(4),await uc(e),e.gu.set("Unknown"),e._u.delete(4),await cc(e)}(this))}))})),this.gu=new oc(n,r)}}async function cc(t){if(gc(t))for(const e of t.wu)await e(!0)}async function uc(t){for(const e of t.wu)await e(!1)}function hc(t,e){const n=Tr(t);n.du.has(e.targetId)||(n.du.set(e.targetId,e),mc(n)?pc(n):Pc(n).ko()&&dc(n,e))}function lc(t,e){const n=Tr(t),r=Pc(n);n.du.delete(e),r.ko()&&fc(n,e),0===n.du.size&&(r.ko()?r.Fo():gc(n)&&n.gu.set("Unknown"))}function dc(t,e){t.yu.Mt(e.targetId),Pc(t).zo(e)}function fc(t,e){t.yu.Mt(e),Pc(t).Ho(e)}function pc(t){t.yu=new Ao({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t.du.get(e)||null}),Pc(t).start(),t.gu.uu()}function mc(t){return gc(t)&&!Pc(t).No()&&t.du.size>0}function gc(t){return 0===Tr(t)._u.size}function yc(t){t.yu=void 0}async function vc(t){t.du.forEach(((e,n)=>{dc(t,e)}))}async function wc(t,e){yc(t),mc(t)?(t.gu.hu(e),pc(t)):t.gu.set("Unknown")}async function Ic(t,e,n){if(t.gu.set("Online"),e instanceof ko&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.du.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.du.delete(r),t.yu.removeTarget(r))}(t,e)}catch(n){mr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Tc(t,n)}else if(e instanceof _o?t.yu.Gt(e):e instanceof So?t.yu.Yt(e):t.yu.Wt(e),!n.isEqual(Vr.min()))try{const e=await Fa(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.yu.te(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.du.get(r);s&&t.du.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.du.get(e);if(!n)return;t.du.set(e,n.withResumeToken(hs.EMPTY_BYTE_STRING,n.snapshotVersion)),fc(t,e);const r=new da(n.target,e,1,n.sequenceNumber);dc(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){mr("RemoteStore","Failed to raise snapshot:",e),await Tc(t,e)}}async function Tc(t,e,n){if(!Zr(e))throw e;t._u.add(1),await uc(t),t.gu.set("Offline"),n||(n=()=>Fa(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{mr("RemoteStore","Retrying IndexedDB access"),await n(),t._u.delete(1),await cc(t)}))}function bc(t,e){return e().catch((n=>Tc(t,n,e)))}async function Ec(t){const e=Tr(t),n=Mc(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;_c(e);)try{const t=await qa(e.localStore,r);if(null===t){0===e.fu.length&&n.Fo();break}r=t.batchId,Sc(e,t)}catch(t){await Tc(e,t)}kc(e)&&Cc(e)}function _c(t){return gc(t)&&t.fu.length<10}function Sc(t,e){t.fu.push(e);const n=Mc(t);n.ko()&&n.Yo&&n.Xo(e.mutations)}function kc(t){return gc(t)&&!Mc(t).No()&&t.fu.length>0}function Cc(t){Mc(t).start()}async function Ac(t){Mc(t).eu()}async function Nc(t){const e=Mc(t);for(const n of t.fu)e.Xo(n.mutations)}async function Dc(t,e,n){const r=t.fu.shift(),s=ha.from(r,e,n);await bc(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Ec(t)}async function Rc(t,e){e&&Mc(t).Yo&&await async function(t,e){if(io(n=e.code)&&n!==br.ABORTED){const n=t.fu.shift();Mc(t).Mo(),await bc(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Ec(t)}var n}(t,e),kc(t)&&Cc(t)}async function Oc(t,e){const n=Tr(t);n.asyncQueue.verifyOperationInProgress(),mr("RemoteStore","RemoteStore received new credentials");const r=gc(n);n._u.add(3),await uc(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n._u.delete(3),await cc(n)}async function Lc(t,e){const n=Tr(t);e?(n._u.delete(2),await cc(n)):e||(n._u.add(2),await uc(n),n.gu.set("Unknown"))}function Pc(t){return t.pu||(t.pu=function(t,e,n){const r=Tr(t);return r.su(),new rc(e,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:vc.bind(null,t),Zr:wc.bind(null,t),Wo:Ic.bind(null,t)}),t.wu.push((async e=>{e?(t.pu.Mo(),mc(t)?pc(t):t.gu.set("Unknown")):(await t.pu.stop(),yc(t))}))),t.pu}function Mc(t){return t.Iu||(t.Iu=function(t,e,n){const r=Tr(t);return r.su(),new sc(e,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:Ac.bind(null,t),Zr:Rc.bind(null,t),tu:Nc.bind(null,t),Zo:Dc.bind(null,t)}),t.wu.push((async e=>{e?(t.Iu.Mo(),await Ec(t)):(await t.Iu.stop(),t.fu.length>0&&(mr("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))}))),t.Iu}class xc{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new _r,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new xc(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Er(br.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Uc(t,e){if(gr("AsyncQueue",`${e}: ${t}`),Zr(t))return new Er(br.UNAVAILABLE,`${e}: ${t}`);throw t}class Vc{constructor(t){this.comparator=t?(e,n)=>t(e,n)||zr.comparator(e.key,n.key):(t,e)=>zr.comparator(t.key,e.key),this.keyedMap=lo(),this.sortedSet=new ss(this.comparator)}static emptySet(t){return new Vc(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Vc))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Vc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Fc{constructor(){this.Tu=new ss(zr.comparator)}track(t){const e=t.doc.key,n=this.Tu.get(e);n?0!==t.type&&3===n.type?this.Tu=this.Tu.insert(e,t):3===t.type&&1!==n.type?this.Tu=this.Tu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Tu=this.Tu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Tu=this.Tu.remove(e):1===t.type&&2===n.type?this.Tu=this.Tu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):wr():this.Tu=this.Tu.insert(e,t)}Eu(){const t=[];return this.Tu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class jc{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new jc(t,e,Vc.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&yi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class qc{constructor(){this.Au=void 0,this.listeners=[]}}class Bc{constructor(){this.queries=new ao((t=>vi(t)),yi),this.onlineState="Unknown",this.Ru=new Set}}async function zc(t,e){const n=Tr(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new qc),s)try{i.Au=await n.onListen(r)}catch(t){const n=Uc(t,`Initialization of query '${wi(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.bu(n.onlineState),i.Au&&e.Pu(i.Au)&&Gc(n)}async function $c(t,e){const n=Tr(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Kc(t,e){const n=Tr(t);let r=!1;for(const s of e){const t=s.query,e=n.queries.get(t);if(e){for(const t of e.listeners)t.Pu(s)&&(r=!0);e.Au=s}}r&&Gc(n)}function Hc(t,e,n){const r=Tr(t),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(n);r.queries.delete(e)}function Gc(t){t.Ru.forEach((t=>{t.next()}))}class Wc{constructor(t,e,n){this.query=t,this.vu=e,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new jc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Vu?this.Du(t)&&(this.vu.next(t),e=!0):this.Cu(t,this.onlineState)&&(this.xu(t),e=!0),this.Su=t,e}onError(t){this.vu.error(t)}bu(t){this.onlineState=t;let e=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,t)&&(this.xu(this.Su),e=!0),e}Cu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Nu||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Du(t){if(t.docChanges.length>0)return!0;const e=this.Su&&this.Su.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}xu(t){t=jc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Vu=!0,this.vu.next(t)}}class Qc{constructor(t){this.key=t}}class Xc{constructor(t){this.key=t}}class Jc{constructor(t,e){this.query=t,this.Uu=e,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=wo(),this.mutatedKeys=wo(),this.Gu=bi(t),this.Qu=new Vc(this.Gu)}get ju(){return this.Uu}Wu(t,e){const n=e?e.zu:new Fc,r=e?e.Qu:this.Qu;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Ii(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Hu(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Gu(h,a)>0||c&&this.Gu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Qu:i,zu:n,$i:o,mutatedKeys:s}}Hu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.Qu;this.Qu=t.Qu,this.mutatedKeys=t.mutatedKeys;const s=t.zu.Eu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return wr()}};return n(t)-n(e)}(t.type,e.type)||this.Gu(t.doc,e.doc))),this.Ju(n);const i=e?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.qu;return this.qu=o,0!==s.length||a?{snapshot:new jc(this.query,t.Qu,r,s,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:i}:{Xu:i}}bu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Fc,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(t){return!this.Uu.has(t)&&!!this.Qu.has(t)&&!this.Qu.get(t).hasLocalMutations}Ju(t){t&&(t.addedDocuments.forEach((t=>this.Uu=this.Uu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Uu=this.Uu.delete(t))),this.current=t.current)}Yu(){if(!this.current)return[];const t=this.Ku;this.Ku=wo(),this.Qu.forEach((t=>{this.Zu(t.key)&&(this.Ku=this.Ku.add(t.key))}));const e=[];return t.forEach((t=>{this.Ku.has(t)||e.push(new Xc(t))})),this.Ku.forEach((n=>{t.has(n)||e.push(new Qc(n))})),e}tc(t){this.Uu=t.Hi,this.Ku=wo();const e=this.Wu(t.documents);return this.applyChanges(e,!0)}ec(){return jc.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class Yc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Zc{constructor(t){this.key=t,this.nc=!1}}class tu{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.sc={},this.ic=new ao((t=>vi(t)),yi),this.rc=new Map,this.oc=new Set,this.uc=new ss(zr.comparator),this.cc=new Map,this.ac=new Sa,this.hc={},this.lc=new Map,this.fc=wa.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function eu(t,e){const n=wu(t);let r,s;const i=n.ic.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const t=await Ba(n.localStore,mi(e));n.isPrimaryClient&&hc(n.remoteStore,t);const i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await nu(n,e,r,"current"===i,t.resumeToken)}return s}async function nu(t,e,n,r,s){t._c=(e,n,r)=>async function(t,e,n,r){let s=e.view.Wu(n);s.$i&&(s=await $a(t.localStore,e.query,!1).then((({documents:t})=>e.view.Wu(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return fu(t,e.targetId,o.Xu),o.snapshot}(t,e,n,r);const i=await $a(t.localStore,e,!0),o=new Jc(e,i.Hi),a=o.Wu(i.documents),c=Eo.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);fu(t,n,u.Xu);const h=new Yc(e,n,o);return t.ic.set(e,h),t.rc.has(n)?t.rc.get(n).push(e):t.rc.set(n,[e]),u.snapshot}async function ru(t,e){const n=Tr(t),r=n.ic.get(e),s=n.rc.get(r.targetId);if(s.length>1)return n.rc.set(r.targetId,s.filter((t=>!yi(t,e)))),void n.ic.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await za(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),lc(n.remoteStore,r.targetId),lu(n,r.targetId)})).catch(Jr)):(lu(n,r.targetId),await za(n.localStore,r.targetId,!0))}async function su(t,e){const n=Tr(t);try{const t=await function(t,e){const n=Tr(t),r=e.snapshotVersion;let s=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Gi.newChangeBuffer({trackRemovals:!0});s=n.Ui;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Cs.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Cs.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?u=u.withResumeToken(hs.EMPTY_BYTE_STRING,Vr.min()).withLastLimboFreeSnapshotVersion(Vr.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Cs.updateTargetData(t,u))}));let a=uo(),c=wo();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(ja(t,i,e.documentUpdates).next((t=>{a=t.Wi,c=t.zi}))),!r.isEqual(Vr.min())){const e=n.Cs.getLastRemoteSnapshotVersion(t).next((e=>n.Cs.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Yr.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ui=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.cc.get(e);r&&(Ir(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.nc=!0:t.modifiedDocuments.size>0?Ir(r.nc):t.removedDocuments.size>0&&(Ir(r.nc),r.nc=!1))})),await gu(n,t,e)}catch(t){await Jr(t)}}function iu(t,e,n){const r=Tr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ic.forEach(((n,r)=>{const s=r.view.bu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Tr(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const s of n.listeners)s.bu(e)&&(r=!0)})),r&&Gc(n)}(r.eventManager,e),t.length&&r.sc.Wo(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ou(t,e,n){const r=Tr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.cc.get(e),i=s&&s.key;if(i){let t=new ss(zr.comparator);t=t.insert(i,qs.newNoDocument(i,Vr.min()));const n=wo().add(i),s=new bo(Vr.min(),new Map,new as(Mr),t,n);await su(r,s),r.uc=r.uc.remove(i),r.cc.delete(e),mu(r)}else await za(r.localStore,e,!1).then((()=>lu(r,e,n))).catch(Jr)}async function au(t,e){const n=Tr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Tr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Gi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Yr.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);Ir(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=wo();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);hu(n,r,null),uu(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await gu(n,t)}catch(t){await Jr(t)}}async function cu(t,e,n){const r=Tr(t);try{const t=await function(t,e){const n=Tr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Ir(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);hu(r,e,n),uu(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await gu(r,t)}catch(n){await Jr(n)}}function uu(t,e){(t.lc.get(e)||[]).forEach((t=>{t.resolve()})),t.lc.delete(e)}function hu(t,e,n){const r=Tr(t);let s=r.hc[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.hc[r.currentUser.toKey()]=s}}function lu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach((e=>{t.ac.containsKey(e)||du(t,e)}))}function du(t,e){t.oc.delete(e.path.canonicalString());const n=t.uc.get(e);null!==n&&(lc(t.remoteStore,n),t.uc=t.uc.remove(e),t.cc.delete(n),mu(t))}function fu(t,e,n){for(const r of n)r instanceof Qc?(t.ac.addReference(r.key,e),pu(t,r)):r instanceof Xc?(mr("SyncEngine","Document no longer in limbo: "+r.key),t.ac.removeReference(r.key,e),t.ac.containsKey(r.key)||du(t,r.key)):wr()}function pu(t,e){const n=e.key,r=n.path.canonicalString();t.uc.get(n)||t.oc.has(r)||(mr("SyncEngine","New document in limbo: "+n),t.oc.add(r),mu(t))}function mu(t){for(;t.oc.size>0&&t.uc.size<t.maxConcurrentLimboResolutions;){const e=t.oc.values().next().value;t.oc.delete(e);const n=new zr(jr.fromString(e)),r=t.fc.next();t.cc.set(r,new Zc(n)),t.uc=t.uc.insert(n,r),hc(t.remoteStore,new da(mi(ui(n.path)),r,2,ts.at))}}async function gu(t,e,n){const r=Tr(t),s=[],i=[],o=[];r.ic.isEmpty()||(r.ic.forEach(((t,a)=>{o.push(r._c(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Pa.Ci(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.sc.Wo(s),await async function(t,e){const n=Tr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Yr.forEach(e,(e=>Yr.forEach(e.Si,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Yr.forEach(e.Di,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Zr(t))throw t;mr("LocalStore","Failed to update sequence numbers: "+t)}for(const r of e){const t=r.targetId;if(!r.fromCache){const e=n.Ui.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.Ui=n.Ui.insert(t,s)}}}(r.localStore,i))}async function yu(t,e){const n=Tr(t);if(!n.currentUser.isEqual(e)){mr("SyncEngine","User change. New user:",e.toKey());const t=await Va(n.localStore,e);n.currentUser=e,function(t,e){t.lc.forEach((t=>{t.forEach((t=>{t.reject(new Er(br.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.lc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await gu(n,t.ji)}}function vu(t,e){const n=Tr(t),r=n.cc.get(e);if(r&&r.nc)return wo().add(r.key);{let t=wo();const r=n.rc.get(e);if(!r)return t;for(const e of r){const r=n.ic.get(e);t=t.unionWith(r.view.ju)}return t}}function wu(t){const e=Tr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=su.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=vu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ou.bind(null,e),e.sc.Wo=Kc.bind(null,e.eventManager),e.sc.wc=Hc.bind(null,e.eventManager),e}function Iu(t){const e=Tr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=au.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cu.bind(null,e),e}class Tu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.It=tc(t.databaseInfo.databaseId),this.sharedClientState=this.gc(t),this.persistence=this.yc(t),await this.persistence.start(),this.localStore=this.Ic(t),this.gcScheduler=this.Tc(t,this.localStore),this.indexBackfillerScheduler=this.Ec(t,this.localStore)}Tc(t,e){return null}Ec(t,e){return null}Ic(t){return Ua(this.persistence,new Ma,t.initialUser,this.It)}yc(t){return new Ra(La.Bs,this.It)}gc(t){return new Ga}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class bu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>iu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=yu.bind(null,this.syncEngine),await Lc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Bc}createDatastore(t){const e=tc(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new Ya(r));var r;return function(t,e,n,r){return new ic(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>iu(this.syncEngine,t,0),i=Qa.C()?new Qa:new Wa,new ac(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new tu(t,e,n,r,s,i);return o&&(a.dc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Tr(t);mr("RemoteStore","RemoteStore shutting down."),e._u.add(5),await uc(e),e.mu.shutdown(),e.gu.set("Unknown")}(this.remoteStore)}}function Eu(t,e,n){if(!n)throw new Er(br.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function _u(t){if(!zr.isDocumentKey(t))throw new Er(br.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Su(t){if(zr.isDocumentKey(t))throw new Er(br.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ku(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":wr()}function Cu(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Er(br.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ku(t);throw new Er(br.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}const Au=new Map;class Nu{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Er(br.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Er(br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,r){if(!0===e&&!0===r)throw new Er(br.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Du{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Er(br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Er(br.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nu(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new kr;switch(t.type){case"gapi":const e=t.client;return new Dr(e,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Er(br.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Au.get(t);e&&(mr("ComponentProvider","Removing Datastore"),Au.delete(t),e.terminate())}(this),Promise.resolve()}}function Ru(t,e,n,r={}){var s;const i=(t=Cu(t,Du))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&yr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=lr.MOCK_USER;else{e=(0,a.Sg)(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Er(br.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new lr(i)}t._authCredentials=new Cr(new Sr(e,n))}}class Ou{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ou(this.firestore,t,this._key)}}class Lu{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Lu(this.firestore,t,this._query)}}class Pu extends Lu{constructor(t,e,n){super(t,e,ui(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ou(this.firestore,null,new zr(t))}withConverter(t){return new Pu(this.firestore,t,this._path)}}function Mu(t,e,...n){if(t=(0,a.m9)(t),Eu("collection","path",e),t instanceof Du){const r=jr.fromString(e,...n);return Su(r),new Pu(t,null,r)}{if(!(t instanceof Ou||t instanceof Pu))throw new Er(br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(jr.fromString(e,...n));return Su(r),new Pu(t.firestore,null,r)}}function xu(t,e,...n){if(t=(0,a.m9)(t),1===arguments.length&&(e=Pr.R()),Eu("doc","path",e),t instanceof Du){const r=jr.fromString(e,...n);return _u(r),new Ou(t,null,new zr(r))}{if(!(t instanceof Ou||t instanceof Pu))throw new Er(br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(jr.fromString(e,...n));return _u(r),new Ou(t.firestore,t instanceof Pu?t.converter:null,new zr(r))}}class Uu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Rc(this.observer.next,t)}error(t){this.observer.error?this.Rc(this.observer.error,t):gr("Uncaught Error in snapshot listener:",t)}bc(){this.muted=!0}Rc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Vu{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=lr.UNAUTHENTICATED,this.clientId=Pr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{mr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(mr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Er(br.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new _r;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Uc(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Fu(t,e){t.asyncQueue.verifyOperationInProgress(),mr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Va(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function ju(t,e){t.asyncQueue.verifyOperationInProgress();const n=await qu(t);mr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>Oc(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Oc(e.remoteStore,n))),t.onlineComponents=e}async function qu(t){return t.offlineComponents||(mr("FirestoreClient","Using default OfflineComponentProvider"),await Fu(t,new Tu)),t.offlineComponents}async function Bu(t){return t.onlineComponents||(mr("FirestoreClient","Using default OnlineComponentProvider"),await ju(t,new bu)),t.onlineComponents}function zu(t){return Bu(t).then((t=>t.syncEngine))}async function $u(t){const e=await Bu(t),n=e.eventManager;return n.onListen=eu.bind(null,e.syncEngine),n.onUnlisten=ru.bind(null,e.syncEngine),n}function Ku(t,e,n={}){const r=new _r;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new Uu({next:n=>{e.enqueueAndForget((()=>$c(t,o))),n.fromCache&&"server"===r.source?s.reject(new Er(br.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Wc(n,i,{includeMetadataChanges:!0,Nu:!0});return zc(t,o)}(await $u(t),t.asyncQueue,e,n,r))),r.promise}class Hu{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new ec(this,"async_queue_retry"),this.Wc=()=>{const t=Za();t&&mr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const t=Za();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.zc(),this.Hc(t)}enterRestrictedMode(t){if(!this.Uc){this.Uc=!0,this.Qc=t||!1;const e=Za();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Wc)}}enqueue(t){if(this.zc(),this.Uc)return new Promise((()=>{}));const e=new _r;return this.Hc((()=>this.Uc&&this.Qc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Lc.push(t),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(T){if(!Zr(T))throw T;mr("AsyncQueue","Operation failed with retryable error: "+T)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(t){const e=this.Bc.then((()=>(this.Gc=!0,t().catch((t=>{this.Kc=t,this.Gc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw gr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Gc=!1,t))))));return this.Bc=e,e}enqueueAfterDelay(t,e,n){this.zc(),this.jc.indexOf(t)>-1&&(e=0);const r=xc.createAndSchedule(this,t,e,n,(t=>this.Yc(t)));return this.qc.push(r),r}zc(){this.Kc&&wr()}verifyOperationInProgress(){}async Xc(){let t;do{t=this.Bc,await t}while(t!==this.Bc)}Zc(t){for(const e of this.qc)if(e.timerId===t)return!0;return!1}ta(t){return this.Xc().then((()=>{this.qc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.qc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Xc()}))}ea(t){this.jc.push(t)}Yc(t){const e=this.qc.indexOf(t);this.qc.splice(e,1)}}function Gu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(t)}class Wu extends Du{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Hu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Yu(this),this._firestoreClient.terminate()}}function Qu(t,e,n){n||(n="(default)");const r=(0,s.qX)(t,"firestore");if(r.isInitialized(n)){const t=r.getImmediate({identifier:n}),s=r.getOptions(n);if((0,a.vZ)(s,e))return t;throw new Er(br.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Er(br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:n})}function Xu(t,e){const n="object"==typeof t?t:(0,s.Mq)(),r="string"==typeof t?t:e||"(default)",i=(0,s.qX)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const t=(0,a.P0)("firestore");t&&Ru(i,...t)}return i}function Ju(t){return t._firestoreClient||Yu(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Yu(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new vs(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Vu(t._authCredentials,t._appCheckCredentials,t._queue,r)}class Zu{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Zu(hs.fromBase64String(t))}catch(t){throw new Er(br.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Zu(hs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class th{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Er(br.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Br(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class eh{constructor(t){this._methodName=t}}class nh{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Er(br.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Er(br.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Mr(this._lat,t._lat)||Mr(this._long,t._long)}}const rh=/^__.*__$/;class sh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Xi(t,this.data,this.fieldMask,e,this.fieldTransforms):new Qi(t,this.data,e,this.fieldTransforms)}}class ih{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Xi(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function oh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw wr()}}class ah{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.It=n,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(t){return new ah(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ia({path:n,oa:!1});return r.ua(t),r}ca(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.ia({path:n,oa:!1});return r.na(),r}aa(t){return this.ia({path:void 0,oa:!0})}ha(t){return Sh(t,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}na(){if(this.path)for(let t=0;t<this.path.length;t++)this.ua(this.path.get(t))}ua(t){if(0===t.length)throw this.ha("Document fields must not be empty");if(oh(this.sa)&&rh.test(t))throw this.ha('Document fields cannot begin and end with "__"')}}class ch{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.It=n||tc(t)}da(t,e,n,r=!1){return new ah({sa:t,methodName:e,fa:n,path:Br.emptyPath(),oa:!1,la:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function uh(t){const e=t._freezeSettings(),n=tc(t._databaseId);return new ch(t._databaseId,!!e.ignoreUndefinedProperties,n)}function hh(t,e,n,r,s,i={}){const o=t.da(i.merge||i.mergeFields?2:0,e,n,s);Th("Data must be an object, but it was:",o,r);const a=wh(r,o);let c,u;if(i.merge)c=new us(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=bh(e,r,n);if(!o.contains(s))throw new Er(br.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);kh(t,s)||t.push(s)}c=new us(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new sh(new Fs(a),c,u)}class lh extends eh{_toFieldTransform(t){if(2!==t.sa)throw 1===t.sa?t.ha(`${this._methodName}() can only appear at the top level of your update data`):t.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof lh}}function dh(t,e,n){return new ah({sa:3,fa:e.settings.fa,methodName:t._methodName,oa:n},e.databaseId,e.It,e.ignoreUndefinedProperties)}class fh extends eh{constructor(t,e){super(t),this._a=e}_toFieldTransform(t){const e=dh(this,t,!0),n=this._a.map((t=>vh(t,e))),r=new Oi(n);return new Fi(t.path,r)}isEqual(t){return this===t}}class ph extends eh{constructor(t,e){super(t),this._a=e}_toFieldTransform(t){const e=dh(this,t,!0),n=this._a.map((t=>vh(t,e))),r=new Pi(n);return new Fi(t.path,r)}isEqual(t){return this===t}}function mh(t,e,n,r){const s=t.da(1,e,n);Th("Data must be an object, but it was:",s,r);const i=[],o=Fs.empty();ns(r,((t,r)=>{const c=_h(e,t,n);r=(0,a.m9)(r);const u=s.ca(c);if(r instanceof lh)i.push(c);else{const t=vh(r,u);null!=t&&(i.push(c),o.set(c,t))}}));const c=new us(i);return new ih(o,c,s.fieldTransforms)}function gh(t,e,n,r,s,i){const o=t.da(1,e,n),c=[bh(e,r,n)],u=[s];if(i.length%2!=0)throw new Er(br.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<i.length;a+=2)c.push(bh(e,i[a])),u.push(i[a+1]);const h=[],l=Fs.empty();for(let f=c.length-1;f>=0;--f)if(!kh(h,c[f])){const t=c[f];let e=u[f];e=(0,a.m9)(e);const n=o.ca(t);if(e instanceof lh)h.push(t);else{const r=vh(e,n);null!=r&&(h.push(t),l.set(t,r))}}const d=new us(h);return new ih(l,d,o.fieldTransforms)}function yh(t,e,n,r=!1){return vh(n,t.da(r?4:3,e))}function vh(t,e){if(Ih(t=(0,a.m9)(t)))return Th("Unsupported field value:",e,t),wh(t,e);if(t instanceof eh)return function(t,e){if(!oh(e.sa))throw e.ha(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.ha(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=vh(s,e.aa(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,a.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ki(e.It,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ur.fromDate(t);return{timestampValue:Po(e.It,n)}}if(t instanceof Ur){const n=new Ur(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Po(e.It,n)}}if(t instanceof nh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Zu)return{bytesValue:Mo(e.It,t._byteString)};if(t instanceof Ou){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Vo(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.ha(`Unsupported field value: ${ku(t)}`)}(t,e)}function wh(t,e){const n={};return rs(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ns(t,((t,r)=>{const s=vh(r,e.ra(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function Ih(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ur||t instanceof nh||t instanceof Zu||t instanceof Ou||t instanceof eh)}function Th(t,e,n){if(!Ih(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=ku(n);throw"an object"===r?e.ha(t+" a custom object"):e.ha(t+" "+r)}}function bh(t,e,n){if((e=(0,a.m9)(e))instanceof th)return e._internalPath;if("string"==typeof e)return _h(t,e);throw Sh("Field path arguments must be of type string or ",t,!1,void 0,n)}const Eh=new RegExp("[~\\*/\\[\\]]");function _h(t,e,n){if(e.search(Eh)>=0)throw Sh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new th(...e.split("."))._internalPath}catch(r){throw Sh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Sh(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Er(br.INVALID_ARGUMENT,a+t+c)}function kh(t,e){return t.some((t=>t.isEqual(e)))}class Ch{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ou(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Ah(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Nh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Ah extends Ch{data(){return super.data()}}function Nh(t,e){return"string"==typeof e?_h(t,e):e instanceof th?e._internalPath:e._delegate._internalPath}function Dh(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Er(br.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Rh{}function Oh(t,...e){for(const n of e)t=n._apply(t);return t}class Lh extends Rh{constructor(t,e,n){super(),this.ma=t,this.ga=e,this.ya=n,this.type="where"}_apply(t){const e=uh(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Er(br.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){xh(o,i);const e=[];for(const n of o)e.push(Mh(r,t,n));a={arrayValue:{values:e}}}else a=Mh(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||xh(o,i),a=yh(n,"where",o,"in"===i||"not-in"===i);const c=Gs.create(s,i,a);return function(t,e){if(e.dt()){const n=di(t);if(null!==n&&!n.isEqual(e.field))throw new Er(br.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=li(t);null!==r&&Uh(t,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Er(br.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Er(br.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.ma,this.ga,this.ya);return new Lu(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new ai(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Ph(t,e,n){const r=e,s=Nh("where",t);return new Lh(s,r,n)}function Mh(t,e,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new Er(br.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fi(e)&&-1!==n.indexOf("/"))throw new Er(br.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(jr.fromString(n));if(!zr.isDocumentKey(r))throw new Er(br.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Rs(t,new zr(r))}if(n instanceof Ou)return Rs(t,n._key);throw new Er(br.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ku(n)}.`)}function xh(t,e){if(!Array.isArray(t)||0===t.length)throw new Er(br.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Er(br.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Uh(t,e,n){if(!n.isEqual(e))throw new Er(br.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Vh{convertValue(t,e="none"){switch(_s(t)){case 0:return null;case 1:return t.booleanValue;case 2:return fs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ps(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw wr()}}convertObject(t,e){const n={};return ns(t.fields,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new nh(fs(t.latitude),fs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=gs(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ys(t));default:return null}}convertTimestamp(t){const e=ds(t);return new Ur(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=jr.fromString(t);Ir(ia(n));const r=new ws(n.get(1),n.get(3)),s=new zr(n.popFirst(5));return r.isEqual(e)||gr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function Fh(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class jh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class qh extends Ch{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Bh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Nh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Bh extends qh{data(t={}){return super.data(t)}}class zh{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new jh(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Bh(this._firestore,this._userDataWriter,n.key,n,new jh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Er(br.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Bh(t._firestore,t._userDataWriter,n.doc.key,n.doc,new jh(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Bh(t._firestore,t._userDataWriter,e.doc.key,e.doc,new jh(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:$h(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function $h(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return wr()}}class Kh extends Vh{constructor(t){super(),this.firestore=t}convertBytes(t){return new Zu(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ou(this.firestore,null,e)}}function Hh(t){t=Cu(t,Lu);const e=Cu(t.firestore,Wu),n=Ju(e),r=new Kh(e);return Dh(t._query),Ku(n,t._query).then((n=>new zh(e,r,t,n)))}function Gh(t,e,n){t=Cu(t,Ou);const r=Cu(t.firestore,Wu),s=Fh(t.converter,e,n);return Yh(r,[hh(uh(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,qi.none())])}function Wh(t,e,n,...r){t=Cu(t,Ou);const s=Cu(t.firestore,Wu),i=uh(s);let o;return o="string"==typeof(e=(0,a.m9)(e))||e instanceof th?gh(i,"updateDoc",t._key,e,n,r):mh(i,"updateDoc",t._key,e),Yh(s,[o.toMutation(t._key,qi.exists(!0))])}function Qh(t){return Yh(Cu(t.firestore,Wu),[new to(t._key,qi.none())])}function Xh(t,e){const n=Cu(t.firestore,Wu),r=xu(t),s=Fh(t.converter,e);return Yh(n,[hh(uh(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,qi.exists(!1))]).then((()=>r))}function Jh(t,...e){var n,r,s;t=(0,a.m9)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Gu(e[o])||(i=e[o],o++);const c={includeMetadataChanges:i.includeMetadataChanges};if(Gu(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let u,h,l;if(t instanceof Ou)h=Cu(t.firestore,Wu),l=ui(t._key.path),u={next:n=>{e[o]&&e[o](Zh(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Cu(t,Lu);h=Cu(n.firestore,Wu),l=n._query;const r=new Kh(h);u={next:t=>{e[o]&&e[o](new zh(h,r,n,t))},error:e[o+1],complete:e[o+2]},Dh(t._query)}return function(t,e,n,r){const s=new Uu(r),i=new Wc(e,s,n);return t.asyncQueue.enqueueAndForget((async()=>zc(await $u(t),i))),()=>{s.bc(),t.asyncQueue.enqueueAndForget((async()=>$c(await $u(t),i)))}}(Ju(h),l,c,u)}function Yh(t,e){return function(t,e){const n=new _r;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Iu(t);try{const t=await function(t,e){const n=Tr(t),r=Ur.now(),s=e.reduce(((t,e)=>t.add(e.key)),wo());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=uo(),c=wo();return n.Gi.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=Gi(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new Xi(t.key,e,js(e.value.mapValue),qi.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:fo(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.hc[t.currentUser.toKey()];r||(r=new ss(Mr)),r=r.insert(e,n),t.hc[t.currentUser.toKey()]=r}(r,t.batchId,n),await gu(r,t.changes),await Ec(r.remoteStore)}catch(t){const e=Uc(t,"Failed to persist write");n.reject(e)}}(await zu(t),e,n))),n.promise}(Ju(t),e)}function Zh(t,e,n){const r=n.docs.get(e._key),s=new Kh(t);return new qh(t,s,e._key,r,new jh(n.hasPendingWrites,n.fromCache),e.converter)}function tl(...t){return new fh("arrayUnion",t)}function el(...t){return new ph("arrayRemove",t)}!function(t,e=!0){!function(t){dr=t}(s.Jn),(0,s.Xd)(new i.wA("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Wu(new Ar(t.getProvider("auth-internal")),new Or(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Er(br.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ws(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),(0,s.KN)(hr,"3.7.2",t),(0,s.KN)(hr,"3.7.2","esm2017")}()},3454:function(t,e,n){"use strict";var r,s;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"===typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(7663)},1118:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(2654)}])},5013:function(t,e,n){"use strict";n.d(e,{a:function(){return i}});var r=n(7294),s=(0,r.createContext)(),i=function(){return(0,r.useContext)(s)};e.Z=s},2654:function(t,e,n){"use strict";n.r(e);var r=n(1799),s=n(5893),i=n(8107),o=n(8006),a=n(7294),c=n(1163),u=n(5013);n(472),n(2687),n(3828);e.default=function(t){var e=t.Component,n=t.pageProps;(0,i.mw)();var h=(0,a.useState)(),l=h[0],d=h[1],f=(0,c.useRouter)();return(0,a.useEffect)((function(){var t=(0,o.v0)();return(0,o.Aj)(t,(function(t){t?d(t):(d(),f.push("/login"))}))}),[]),(0,s.jsx)(u.Z.Provider,{value:l,children:(0,s.jsx)(e,(0,r.Z)({},n))})}},2687:function(){},3828:function(){},472:function(){},7663:function(t){!function(){var e={229:function(t){var e,n,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"===typeof setTimeout?setTimeout:s}catch(t){e=s}try{n="function"===typeof clearTimeout?clearTimeout:i}catch(t){n=i}}();var a,c=[],u=!1,h=-1;function l(){u&&a&&(u=!1,a.length?c=a.concat(c):h=-1,c.length&&d())}function d(){if(!u){var t=o(l);u=!0;for(var e=c.length;e;){for(a=c,c=[];++h<e;)a&&a[h].run();h=-1,e=c.length}a=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new f(t,e)),1!==c.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(t){var s=n[t];if(void 0!==s)return s.exports;var i=n[t]={exports:{}},o=!0;try{e[t](i,i.exports,r),o=!1}finally{o&&delete n[t]}return i.exports}r.ab="//";var s=r(229);t.exports=s}()},1163:function(t,e,n){t.exports=n(387)},5816:function(t,e,n){"use strict";n.d(e,{Jn:function(){return x},qX:function(){return O},Xd:function(){return R},Mq:function(){return V},ZF:function(){return U},KN:function(){return F}});var r=n(8463),s=n(3333),i=n(4444);let o,a;const c=new WeakMap,u=new WeakMap,h=new WeakMap,l=new WeakMap,d=new WeakMap;let f={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return u.get(t);if("objectStoreNames"===e)return t.objectStoreNames||h.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function p(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(y(this),e),g(c.get(this))}:function(...e){return g(t.apply(y(this),e))}:function(e,...n){const r=t.call(y(this),e,...n);return h.set(r,e.sort?e.sort():[e]),g(r)}}function m(t){return"function"===typeof t?p(t):(t instanceof IDBTransaction&&function(t){if(u.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));u.set(t,e)}(t),e=t,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>e instanceof t))?new Proxy(t,f):t);var e}function g(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(g(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&c.set(e,t)})).catch((()=>{})),d.set(e,t),e}(t);if(l.has(t))return l.get(t);const e=m(t);return e!==t&&(l.set(t,e),d.set(e,t)),e}const y=t=>d.get(t);const v=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],I=new Map;function T(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(I.get(e))return I.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=w.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!v.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return I.set(e,i),i}f=(t=>({...t,get:(e,n,r)=>T(e,n)||t.get(e,n,r),has:(e,n)=>!!T(e,n)||t.has(e,n)}))(f);class b{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const E="@firebase/app",_="0.8.3",S=new s.Yd("@firebase/app"),k="[DEFAULT]",C={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},A=new Map,N=new Map;function D(t,e){try{t.container.addComponent(e)}catch(n){S.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function R(t){const e=t.name;if(N.has(e))return S.debug(`There were multiple attempts to register component ${e}.`),!1;N.set(e,t);for(const n of A.values())D(n,t);return!0}function O(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const L={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},P=new i.LL("app","Firebase",L);class M{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw P.create("app-deleted",{appName:this._name})}}const x="9.13.0";function U(t,e={}){let n=t;if("object"!==typeof e){e={name:e}}const s=Object.assign({name:k,automaticDataCollectionEnabled:!1},e),o=s.name;if("string"!==typeof o||!o)throw P.create("bad-app-name",{appName:String(o)});if(n||(n=(0,i.aH)()),!n)throw P.create("no-options");const a=A.get(o);if(a){if((0,i.vZ)(n,a.options)&&(0,i.vZ)(s,a.config))return a;throw P.create("duplicate-app",{appName:o})}const c=new r.H0(o);for(const r of N.values())c.addComponent(r);const u=new M(n,s,c);return A.set(o,u),u}function V(t="[DEFAULT]"){const e=A.get(t);if(!e&&t===k)return U();if(!e)throw P.create("no-app",{appName:t});return e}function F(t,e,n){var s;let i=null!==(s=C[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${i}" with version "${e}":`];return o&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void S.warn(t.join(" "))}R(new r.wA(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const j="firebase-heartbeat-store";let q=null;function B(){return q||(q=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=g(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(g(o.result),t.oldVersion,t.newVersion,g(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(j)}}).catch((t=>{throw P.create("idb-open",{originalErrorMessage:t.message})}))),q}async function z(t,e){var n;try{const n=(await B()).transaction(j,"readwrite"),r=n.objectStore(j);return await r.put(e,$(t)),n.done}catch(r){if(r instanceof i.ZR)S.warn(r.message);else{const t=P.create("idb-set",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message});S.warn(t.message)}}}function $(t){return`${t.name}!${t.options.appId}`}class K{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new G(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=H();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=H(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),W(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),W(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,i.L)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function H(){return(new Date).toISOString().substring(0,10)}class G{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.hl)()&&(0,i.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(t){var e;try{return(await B()).transaction(j).objectStore(j).get($(t))}catch(n){if(n instanceof i.ZR)S.warn(n.message);else{const t=P.create("idb-get",{originalErrorMessage:null===(e=n)||void 0===e?void 0:e.message});S.warn(t.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return z(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return z(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function W(t){return(0,i.L)(JSON.stringify({version:2,heartbeats:t})).length}var Q;Q="",R(new r.wA("platform-logger",(t=>new b(t)),"PRIVATE")),R(new r.wA("heartbeat",(t=>new K(t)),"PRIVATE")),F(E,_,Q),F(E,_,"esm2017"),F("fire-js","")},8463:function(t,e,n){"use strict";n.d(e,{H0:function(){return a},wA:function(){return s}});var r=n(4444);class s{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const i="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.BH;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),r=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:r});n.resolve(t)}catch(e){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&i.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(r){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===i?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(s){}var r;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:i:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},3333:function(t,e,n){"use strict";n.d(e,{Yd:function(){return u},in:function(){return s}});const r=[];var s;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=a[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class u{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in s))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?i[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...t),this._logHandler(this,s.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...t),this._logHandler(this,s.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,s.INFO,...t),this._logHandler(this,s.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,s.WARN,...t),this._logHandler(this,s.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...t),this._logHandler(this,s.ERROR,...t)}}},7568:function(t,e,n){"use strict";function r(t,e,n,r,s,i,o){try{var a=t[i](o),c=a.value}catch(u){return void n(u)}a.done?e(c):Promise.resolve(c).then(r,s)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(s,i){var o=t.apply(e,n);function a(t){r(o,s,i,a,c,"next",t)}function c(t){r(o,s,i,a,c,"throw",t)}a(void 0)}))}}n.d(e,{Z:function(){return s}})},1799:function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},s=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),s.forEach((function(e){r(t,e,n[e])}))}return t}n.d(e,{Z:function(){return s}})},9396:function(t,e,n){"use strict";function r(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}n.d(e,{Z:function(){return r}})},8107:function(t,e,n){"use strict";n.d(e,{bq:function(){return E},xL:function(){return f},f6:function(){return S},tS:function(){return w},mw:function(){return d},dA:function(){return y},VB:function(){return T},Ds:function(){return m}});var r=n(7568),s=n(1799),i=n(9396),o=n(655),a=n(5816);(0,a.KN)("firebase","9.13.0","app");var c=n(5321),u=n(8006),h=n(3454),l={apiKey:"AIzaSyCaJxdy1fmtSNcgo-ld38L80-u5OfwUNBo",authDomain:"quiz-6ceb9.firebaseapp.com",projectId:"quiz-6ceb9",storageBucket:"quiz-6ceb9.appspot.com",messagingSenderId:"561397415785",appId:"1:561397415785:web:5a7768c62d82e318dd07f8",measurementId:"G-625GXBVSMR"};function d(){try{return(0,a.Mq)()}catch(r){var t=(0,a.ZF)(l),e=(0,c.LV)(t,{useFetchStreams:!1});if(h.env.NEXT_PUBLIC_EMULATE||h.env.FIRESTORE_EMULATOR_HOST){var n=(0,u.v0)(t);(0,u.S$)(n,"http://localhost:9099"),(0,c.at)(e,"localhost",8080)}return t}}function f(t){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)((function(t){var e,n,r,s;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return e=(0,c.ad)(),n=JSON.parse(JSON.stringify(t)),r=(0,c.hJ)(e,"courses"),[4,(0,c.pl)((0,c.JU)(r,t.course),{id:t.uid,name:t.course,students:(0,c.vr)()},{merge:!0})];case 1:return i.sent(),r=(0,c.hJ)(e,"courses",t.course,"topics"),[4,(0,c.pl)((0,c.JU)(r,t.topic),{name:t.topic})];case 2:return i.sent(),r=(0,c.hJ)(e,"courses",t.course,"topics",t.topic,"questions"),[4,(0,c.ET)(r,n)];case 3:return s=i.sent(),[2,{question:t.question,answer:t.answer,response:t.response,topic:t.topic,id:s.id,course:t.course,uid:t.uid}]}}))}))).apply(this,arguments)}function m(t,e){return g.apply(this,arguments)}function g(){return(g=(0,r.Z)((function(t,e){var n,r,s,i,a,u,h;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return n=(0,c.ad)(),r=t.question,e.question&&(r=e.question),s=t.answer,e.answer&&(s=e.answer),i=(0,c.hJ)(n,"courses",t.course,"topics",t.topic,"questions"),a=(0,c.IO)(i,(0,c.ar)("question","==",t.question)),[4,(0,c.PL)(a)];case 1:return u=o.sent(),h=(0,c.JU)(n,"courses",t.course,"topics",t.topic,"questions",u.docs[0].id),[4,(0,c.r7)(h,{question:r,answer:s})];case 2:return o.sent(),[2,{answer:s,course:t.course,question:r,topic:t.topic,uid:t.id}]}}))}))).apply(this,arguments)}function y(t){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)((function(t){var e,n,r,s,i,a,u;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return e=(0,c.ad)(),n=(0,c.hJ)(e,"courses",t.course,"topics",t.topic,"questions"),r=(0,c.IO)(n,(0,c.ar)("question","==",t.question)),[4,(0,c.PL)(r)];case 1:return s=o.sent(),[4,(0,c.PL)(n)];case 2:return i=o.sent(),a=t.topic,u=(0,c.JU)(e,"courses",t.course,"topics",t.topic,"questions",s.docs[0].id),[4,(0,c.oe)(u)];case 3:return o.sent(),i.size<=1?[4,(0,c.oe)((0,c.JU)(e,"courses",t.course,"topics",a))]:[3,5];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))).apply(this,arguments)}function w(t,e){return I.apply(this,arguments)}function I(){return(I=(0,r.Z)((function(t,e){var n,r;return(0,o.__generator)(this,(function(s){switch(s.label){case 0:return n=(0,c.ad)(),r=(0,c.JU)(n,"courses",t),[4,(0,c.r7)(r,{students:(0,c.vr)(e)})];case 1:return s.sent(),[2]}}))}))).apply(this,arguments)}function T(t,e){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)((function(t,e){var n,r;return(0,o.__generator)(this,(function(s){switch(s.label){case 0:return n=(0,c.ad)(),r=(0,c.JU)(n,"courses",t),[4,(0,c.r7)(r,{students:(0,c.Ab)(e)})];case 1:return s.sent(),[2]}}))}))).apply(this,arguments)}function E(t,e){return _.apply(this,arguments)}function _(){return(_=(0,r.Z)((function(t,e){var n;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return n=(0,c.ad)(),[4,(0,c.pl)((0,c.JU)(n,"courses",e),{name:e,id:t,students:[]})];case 1:return r.sent(),[2]}}))}))).apply(this,arguments)}function S(t,e,n){return k.apply(this,arguments)}function k(){return(k=(0,r.Z)((function(t,e,n){var r,a,u,h;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return r=new Date,a=(0,i.Z)((0,s.Z)({},t),{student:n,course:e,date:r.toLocaleString()}),u=(0,c.ad)(),[4,(0,c.pl)((0,c.JU)(u,"courses",e,"results",n),{email:n},{merge:!0})];case 1:return o.sent(),h=(0,c.hJ)(u,"courses",e,"results",n,"quizResults"),[4,(0,c.ET)(h,a)];case 2:return o.sent(),[2,(0,s.Z)({},a)]}}))}))).apply(this,arguments)}}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[774,179],(function(){return e(1118),e(387)}));var n=t.O();_N_E=n}]);